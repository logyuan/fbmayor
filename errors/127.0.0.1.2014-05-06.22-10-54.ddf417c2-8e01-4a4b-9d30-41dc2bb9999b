(dp1
S'output'
p2
S"<class 'bson.errors.InvalidDocument'> Cannot encode object: datetime.timedelta(1)"
p3
sS'layer'
p4
S'/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\nimport ExtendedOpenGraph\nfrom facebook import GraphAPI, GraphAPIError\nimport json\nfrom collections import OrderedDict\nimport datetime\nfrom dateutil import parser\n\n@auth.requires_login()\ndef test2():\n    import time\n    graph = getGraph()\n    #rows = fbpl().select(fbpl.post.ALL)\n    gid = \'652438848137404\'\n    fb_obj = graph.request(gid, args={\'fields\': \'insights\'})\n    insights=[]\n    insights = fb_obj["insights"]["data"] if  (\'insights\' in fb_obj) else []\n    lifetime_likes = sum(insights[0]["values"][2]["value"].values())\n    daily_people_talking = sum(insights[1]["values"][2]["value"].values())\n    weekly_people_talking = sum(insights[2]["values"][2]["value"].values())\n    monthly_people_talking = sum(insights[3]["values"][2]["value"].values())\n    return str(lifetime_likes) + \' \' + str(daily_people_talking) + \' \' + str(weekly_people_talking)+ \' \' +str(monthly_people_talking)\n\ndef test():\n    date = datetime.datetime.strptime("2014-04-25 00:00:00", \'%Y-%m-%d %H:%M:%S\')            \n    date2 = date + datetime.timedelta(hours=24)\n    date3 = date2 + datetime.timedelta(hours=24)\n    likes1 = fbpl((fbpl.post_counts.date_time >= date)).select().first()\n    likes2 = fbpl((fbpl.post_counts.date_time >= date2) ).select().first()\n    Posts = fbpl((fbpl.post.team == \'\xe6\x9f\xaf\xe6\x96\x87\xe5\x93\xb2\') & (fbpl.post.status_type <> \'\') & (fbpl.post.created_time >= date) & (fbpl.post.created_time < date2) ).select()\n    dailyPosts =len(Posts)\n    return dict(likes1=likes1,likes2=likes2,dailyPosts=dailyPosts)\n\ndef fixtime():\n    #hour48 = (now - datetime.timedelta(days=2)).strftime(\'%Y-%m-%d %H:%M:%S\')\n    #hour48 = datetime.datetime.strptime(hour48,\'%Y-%m-%d %H:%M:%S\')\n    rows = fbpl(fbpl.post.id>0).select()\n    for row in rows:\n        created_time = str(row.created_time)\n        #created_time2 = created_time\n        #updated_time= row.updated_time.strftime(\'%Y-%m-%d %H:%M:%S\')\n        created_time = datetime.datetime.strptime(created_time,\'%Y-%m-%d %H:%M:%S\')\n        #updated_time = datetime.datetime.strptime(updated_time,\'%Y-%m-%d %H:%M:%S\')\n\n        row.update_record(created_time=created_time)\n    return "success"\n\ndef fixtime2():\n\n    rows = fbpl(fbpl.post_counts.id>0).select()\n    for row in rows:\n        date_time = row.date_time.strftime(\'%Y-%m-%d %H:%M:%S\')\n        date_time = datetime.datetime.strptime(date_time,\'%Y-%m-%d %H:%M:%S\' )\n        #updated_time= (date_time - datetime.timedelta(hours=7)).strftime(\'%Y-%m-%d %H:%M:%S\')\n        #updated_time = datetime.datetime.strptime(updated_time,\'%Y-%m-%d %H:%M:%S\' )\n        \n        row.update_record(date_time=date_time)\n    return "success"\n\ndef postCount():\n    fid =\'452668974835088\'\n    date = \'2014-04-29 08:00:00\'\n    date2 = + datetime.timedelta(days=1)\n    #date= datetime.datetime.utcnow()\n    #date= datetime.datetime.strptime(\'2014-04-29 08:00:00\',\'%Y-%m-%d %H:%M:%S\')\n    #date2 = datetime.datetime.strptime(\'2014-04-30 08:00:00\',\'%Y-%m-%d %H:%M:%S\')\n    Posts = fbpl( (fbpl.post_counts.fid == fid) & (fbpl.post_counts.updated_time >= date) & (fbpl.post_counts.updated_time < date2)).select()\n    posts_today=len(Posts)\n    return posts_today\n\n\n#1.\xe9\x80\x99\xe9\x83\xa8\xe4\xbb\xbd\xe6\x8e\x92\xe7\xa8\x8b\xe6\x8a\x8a\xe6\x89\x80\xe6\x9c\x89\xe7\x9a\x84\xe5\xb0\x88\xe9\xa0\x81\xe7\x9a\x84likes \xe9\x82\x84\xe6\x9c\x89 talkingabout\xe6\x9b\xb4\xe6\x96\xb0\xe3\x80\x82\n@auth.requires_login()\ndef countAllPageSocialCount():\n    import datetime\n    import time\n\n    graph = getGraph()\n    rows = fbpl().select(fbpl.page.pageid, orderby=fbpl.page.id)\n    start_date_time=datetime.datetime.today().strftime(\'%Y-%m-%d %H:%M:%S\')\n    start_date_time=datetime.datetime.strptime(start_date_time, \'%Y-%m-%d %H:%M:%S\')\n    for row in rows:\n        gid= row.pageid\n        #check if the Facebook has the graphic\n        getPageSocialCount(gid)\n\n    message = teamCount()\n    end_date_time=datetime.datetime.today().strftime(\'%Y-%m-%d %H:%M:%S\')\n    end_date_time=datetime.datetime.strptime(end_date_time, \'%Y-%m-%d %H:%M:%S\')\n    fbpl.update_log.insert(start_date_time=start_date_time,end_date_time=end_date_time)\n    message = \'Successfully update socialcount of pages\'\n    return dict(message=message)\n\n#2.get likes , checkins, were_here_count, talking_about_count, \n@auth.requires_login()\ndef getPageSocialCount(gid):\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        if gid:\n            oid = gid\n        else:\n            message=\'failure, please check your placeid!\'\n            return dict(message=message)\n        pid = checkGraphId(oid)\n        if pid <> \'0\':\n            if pid <> oid :\n                record2 = fbpl(fbpl.page.pageid==pid).select().first()\n                if not (record2) :\n                   getPage(pid)\n                   time.sleep(1)\n                   fbpl(fbpl.page.pageid==oid).delete()\n            fb_obj = graph.request(pid ,args={\'fields\': \'id,name, category, about, can_post, checkins, talking_about_count, were_here_count, link,description, cover, website, picture.type(large), is_published,likes.limit(1).summary(true), insights\'})\n            checkins =  fb_obj["checkins"] if  (\'checkins\' in fb_obj) else 0\n            likes= fb_obj["likes"] if  (\'likes\' in fb_obj) else 0\n            were_here_count= fb_obj["were_here_count"] if  (\'were_here_count\' in fb_obj) else 0\n            talking_about_count\t = fb_obj["talking_about_count"] if  (\'talking_about_count\' in fb_obj) else 0\n            updated_time = datetime.datetime.utcnow().strftime(\'%Y-%m-%dT%H:%M:%S+0000\')\n            updated_time = datetime.datetime.strptime(updated_time,\'%Y-%m-%dT%H:%M:%S+0000\')\n            date_time = datetime.datetime.today().strftime(\'%Y-%m-%d %H:%M:%S\')\n            date_time = datetime.datetime.strptime(date_time,\'%Y-%m-%d %H:%M:%S\')\n            row = fbpl.page(pageid=pid)\n            checkins24= 0\n            likes24 = 0\n            were_here_count24 = 0\n            talking_about_count24 = 0\n            if row:\n                fbpl.social_counts.insert(placeid=pid,checkins = checkins,likes=likes,date_time=date_time,were_here_count=were_here_count,updated_time=updated_time,talking_about_count=talking_about_count)\n                fbpl.commit()\n                likes_sincelastupdate = int(likes)-int(row.likes) if likes else 0\n                checkins_sincelastupdate = int(checkins)-int(row.checkins) if checkins else 0\n                talking_about_sincelastupdate = int(talking_about_count)-int(row.talking_about_count) if talking_about_count else 0\n                were_here_sincelastupdate = int(were_here_count)-int(row.were_here_count) if were_here_count else 0\n                plist = getPageCount(gid, 0 , 1)\n                checkins24= plist[0]\n                likes24 = plist[1]\n                were_here_count24= plist[2]\n                talking_about_count24= plist[3]\n                #now = datetime.datetime.now()\n                #hour24 = hourdiff(now,24)\n                #row2 = fbpl((fbpl.social_counts.date_time <= hour24) & (fbpl.social_counts.placeid==pid) ).select(fbpl.social_counts.ALL).last()\n                #if row2:\n                #    likes_sincelastupdate = int(likes)-int(row2.likes) if likes else 0\n                #    checkins_sincelastupdate = int(checkins)-int(row2.checkins) if checkins else 0\n                #    talking_about_sincelastupdate = int(talking_about_count)-int(row2.talking_about_count) if talking_about_count else 0\n                #    were_here_sincelastupdate = int(were_here_count)-int(row2.were_here_count) if were_here_count else 0\n                #else:  #if no record can be found in the social_counts then use the last time number\n                #    likes_sincelastupdate = int(likes)-int(row.likes) if likes else 0\n                #    checkins_sincelastupdate = int(checkins)-int(row.checkins) if checkins else 0\n                #    talking_about_sincelastupdate = int(talking_about_count)-int(row.talking_about_count) if talking_about_count else 0\n                #    were_here_sincelastupdate = int(were_here_count)-int(row.were_here_count) if were_here_count else 0\n                row.update_record(checkins = checkins, likes=likes, date_time=date_time, were_here_count=were_here_count, updated_time=updated_time, talking_about_count=talking_about_count, likes_sincelastupdate=likes_sincelastupdate, talking_about_sincelastupdate=talking_about_sincelastupdate, checkins_sincelastupdate=checkins_sincelastupdate, were_here_sincelastupdate=were_here_sincelastupdate , checkins24=checkins24, likes24=likes24, were_here_count24=were_here_count24, talking_about_count24=talking_about_count24 )\n            else:\n                likes_sincelastupdate =  0\n                checkins_sincelastupdate =  0\n                talking_about_sincelastupdate = 0\n                were_here_sincelastupdate = 0\n                fbpl.page.insert(pageid=pid, checkins = checkins, likes=likes, date_time=date_time, were_here_count=were_here_count, updated_time=updated_time, talking_about_count=talking_about_count, likes_sincelastupdate=likes_sincelastupdate, talking_about_sincelastupdate=talking_about_sincelastupdate, checkins_sincelastupdate=checkins_sincelastupdate, were_here_sincelastupdate=were_here_sincelastupdate)\n                fbpl.commit()\n                fbpl.social_counts.insert(placeid=pid,checkins = checkins,likes=likes,date_time=date_time,were_here_count=were_here_count,updated_time=updated_time,talking_about_count=talking_about_count)\n                fbpl.commit()\n            time.sleep(1.1)\n            message=\'Successfully update the PageSocialCount\'\n            return dict(message=message)\n        else:\n            return dict(message=\'failure, please check your placeid!\')\n\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n\n\n    #response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=message)  #dict(message=str[9])\n\n#3.\xe6\xaa\xa2\xe6\x9f\xa5\xe5\x90\x84\xe5\x80\x8b\xe5\xb0\x88\xe9\xa0\x81\xe6\x98\xaf\xe5\x90\xa6\xe6\x9c\x89\xe6\x96\xb0\xe6\x96\x87\xe7\xab\xa0\n@auth.requires_login()\ndef collect_posts():\n    import time\n    rows = fbpl().select(fbpl.page.pageid)\n    for row in rows:\n        getPagePosts(row.pageid)\n        time.sleep(1)\n    return "All page posts Finished"\n\n#4.\n@auth.requires_login()\ndef getPagePosts(pageid):\n    import time\n    try:\n        graph = getGraph()\n        posts_data=graph.request(pageid + \'/posts\', args={\'fields\':\'id, place, message, updated_time, from, created_time, status_type, type, link, picture, likes.limit(1).summary(true), shares, comments.limit(1).summary(true), object_id\'})\n        data = []\n        data = posts_data["data"]\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pageid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n    try:\n        for post in data:\n            fid = post["id"].split(\'_\')[1]\n            row = fbpl.post(fid=fid)\n            if row:\n                pass\n                #message =  post["message"] if (\'message\' in post) else \'\'\n                #updated_time = datetime.datetime.strptime(post["updated_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'updated_time\' in post) else \'\'\n                #likes_count = post["likes"]["summary"]["total_count"] if (\'likes\' in post) else 0\n                #comment_count = post["comments"]["summary"]["total_count"] if (\'comments\' in post) else 0\n                #shares_count = post["shares"][\'count\'] if (\'shares\' in post) else 0\n                #now = datetime.datetime.utcnow()\n                #hour48 = hourdiff(now,48)\n                #row2 = fbpl((fbpl.post_counts.date_time <= hour48) & (fbpl.post_counts.fid==fid) ).select(fbpl.post_counts.ALL).last()\n                #if row2:\n                #    likes_sincelastupdate = int(likes_count)-int(row2.likes_count) if likes_count else 0\n                #    shares_sincelastupdate = int(shares_count)-int(row2.shares_count) if shares_count else 0\n                #    comment_sincelastupdate = int(comment_count)-int(row2.comment_count) if comment_count else 0\n                #else:  #if no record can be found in the post_counts then use the last time number\n                #    likes_sincelastupdate = int(likes_count)-int(row.likes_count) if likes_count else 0\n                #    shares_sincelastupdate = int(shares_count)-int(row.shares_count) if shares_count else 0\n                #    comment_sincelastupdate = int(comment_count)-int(row.comment_count) if comment_count else 0\n                #likes_sincelastupdate = int(likes_count)-int(row.likes_count) if likes_count else 0\n                #shares_sincelastupdate = int(shares_count)-int(row.shares_count) if shares_count else 0\n                #comment_sincelastupdate = int(comment_count)-int(row.comment_count) if comment_count else 0                \n\n                #link= row["link"]\n                #object_id = row["object_id"]\n                #------------ after update it can be deleted\n                #ptype = row.ptype\n                #if (ptype == \'link\' ) | (ptype == \'video\'):\n                #    try:\n                #        picture =getOpengraphImage(link)\n                #        if picture == \'\':\n                #            picture = post["picture"] if (\'picture\' in post) else \'\'\n                #    except:\n                #        picture = post["picture"] if (\'picture\' in post) else \'\'\n                #elif (ptype == \'photo\' ) :\n                #    try:\n                #        images=[]\n                #        images =graph.request(object_id , args={\'fields\':\'images\'})["images"]\n                #        for image in images:\n                #            if (image["height"] > 200) & (image["width"] > 150):\n                #                picture = image["source"]\n                        #time.sleep(1)\n                #    except:\n                #       picture = post["picture"] if (\'picture\' in post) else \'\'\n                #else:\n                #    picture = post["picture"] if (\'picture\' in post) else \'\'\n\n                #row.update_record(message=message, shares_count=shares_count, likes_count=likes_count, comment_count=comment_count, likes_sincelastupdate=likes_sincelastupdate, shares_sincelastupdate=shares_sincelastupdate, comment_sincelastupdate=comment_sincelastupdate, updated_time=updated_time,picture=picture)\n            else:\n                message =  post["message"] if (\'message\' in post) else \'\'\n                from_id = post["from"]["id"] if (\'from\' in post) else \'\'\n                from_name = post["from"]["name"] if (\'from\' in post) else \'\'\n                created_time = datetime.datetime.strptime(post["created_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'created_time\' in post) else \'\'\n                updated_time = datetime.datetime.strptime(post["updated_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'updated_time\' in post) else \'\'\n                status_type = post["status_type"] if (\'status_type\' in post) else \'\'\n                ptype = post["type"] if (\'type\' in post) else \'\'\n                status_type = post["status_type"] if (\'status_type\' in post) else \'\'\n                link = post["link"] if (\'link\' in post) else \'\'\n                shares_count = post["shares"][\'count\'] if (\'shares\' in post) else 0\n                likes_count = post["likes"]["summary"]["total_count"] if (\'likes\' in post) else 0\n                comment_count = post["comments"]["summary"]["total_count"] if (\'comments\' in post) else 0\n                object_id = post["object_id"] if (\'object_id\' in post) else \'\'\n                placeid = post["place"]["id"] if (\'place\' in post) else \'\'\n                placename = post["place"]["name"] if (\'place\' in post) else \'\'\n                tscore = shares_count*0.5 + comment_count*0.3 + likes_count*0.2\n                if placeid != \'\' :\n                    getPlace(placeid)\n                    time.sleep(1)\n                row=fbpl(fbpl.page.pageid==from_id).select().first()\n                team = row[\'team\']\n                likes_sincelastupdate=0\n                shares_sincelastupdate=0\n                comment_sincelastupdate=0\n                if (ptype == \'link\' ) | (ptype == \'video\'):\n                    try:\n                        picture =getOpengraphImage(link)\n                        if picture == \'\':\n                            picture = post["picture"] if (\'picture\' in post) else \'\'\n                    except:\n                        picture = post["picture"] if (\'picture\' in post) else \'\'\n                elif (ptype == \'photo\' ) :\n                    try:\n                        images=[]\n                        images =graph.request(object_id , args={\'fields\':\'images\'})["images"]\n                        for image in images:\n                            if (image["height"] > 200) & (image["width"] > 150):\n                                picture = image["source"]\n                        #time.sleep(1)\n                    except:\n                        picture = post["picture"] if (\'picture\' in post) else \'\'\n                else:\n                    picture = post["picture"] if (\'picture\' in post) else \'\'\n                \n                fbpl.post.insert(fid=fid, message=message,from_id=from_id, from_name=from_name, created_time=created_time,object_id=object_id,ptype=ptype,status_type=status_type, link=link, picture=picture ,shares_count=shares_count, likes_count=likes_count, comment_count=comment_count, likes_sincelastupdate=likes_sincelastupdate, shares_sincelastupdate=shares_sincelastupdate, comment_sincelastupdate=comment_sincelastupdate, team=team, placeid=placeid, placename=placename, updated_time=updated_time, tscore=tscore)\n                fbpl.commit()\n\n        message = "all posts finished"\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=fid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n#5.\n@auth.requires_login()\ndef getPostSocialCount(from_id,fid):\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        if fid:\n            fb_obj = graph.request(from_id + \'_\' + fid ,args={\'fields\': \'id, shares, updated_time,comments.limit(1).summary(true), message, likes.limit(1).summary(true)\'})\n\n            shares_count = int(fb_obj["shares"]["count"]) if (\'shares\' in fb_obj) else 0\n            updated_time = datetime.datetime.strptime(fb_obj["updated_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'updated_time\' in fb_obj) else \'\'\n            likes_count = int(fb_obj["likes"]["summary"]["total_count"]) if (\'likes\' in fb_obj) else 0\n            comment_count = int(fb_obj["comments"]["summary"]["total_count"]) if (\'comments\' in fb_obj) else 0\n            date_time = datetime.datetime.today()\n            row = fbpl(fbpl.post.fid==str(fid)).select().first()\n            if row :\n                fbpl.post_counts.insert(fid=fid, updated_time=updated_time, shares_count=shares_count, date_time=date_time, likes_count=likes_count, comment_count=comment_count)\n                fbpl.commit()\n                #post used s local_time, it is better in the future all the Fields use the UTC time format\n            #    now = datetime.datetime.now()\n            #    hour48 = hourdiff(now,48)\n            #    row2 = fbpl((fbpl.post_counts.date_time >= hour48) & (fbpl.post_counts.fid==fid) ).select(fbpl.post_counts.ALL).first()\n            #    if row2:\n            #        likes_sincelastupdate = int(likes_count)-int(row2.likes_count) if likes_count else 0\n            #        shares_sincelastupdate = int(shares_count)-int(row2.shares_count) if shares_count else 0\n            #        comment_sincelastupdate = int(comment_count)-int(row2.comment_count) if comment_count else 0\n            #    else:  #if no record can be found in the post_counts then use the last time number\n            #        likes_sincelastupdate = int(likes_count)-int(row.likes_count) if likes_count else 0\n            #        shares_sincelastupdate = int(shares_count)-int(row.shares_count) if shares_count else 0\n            #        comment_sincelastupdate = int(comment_count)-int(row.comment_count) if comment_count else 0\n            #\n                likes_sincelastupdate = int(likes_count)-int(row.likes_count) if likes_count else 0\n                shares_sincelastupdate = int(shares_count)-int(row.shares_count) if shares_count else 0\n                comment_sincelastupdate = int(comment_count)-int(row.comment_count) if comment_count else 0\n                list1 = getPostCount(fid, 0, 2)\n                likes_count48= list1[0]\n                comment_count48= list1[1]\n                shares_count48= list1[2]\n                fscore = shares_count48*0.5 + comment_count48*0.3 + likes_count48*0.2\n                tscore = shares_count*0.5 + comment_count*0.3 + likes_count*0.2\n                row.update_record(updated_time=updated_time, shares_count=shares_count, likes_count=likes_count, comment_count=comment_count,likes_sincelastupdate=likes_sincelastupdate,shares_sincelastupdate=shares_sincelastupdate,comment_sincelastupdate=comment_sincelastupdate, fscore=fscore, likes_count48=likes_count48, comment_count48=comment_count48, shares_count48=shares_count48, tscore=tscore)\n\n\n            time.sleep(1)\n            message=\'Successfully update the PostSocialCount\'\n            return dict(message=message)\n        else:\n            return dict(message=\'failure, please check your placeid!\')\n\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=fid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n\n    #response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=message)  #dict(message=str[9])\n\n\n\n#6\n\n@auth.requires_login()\ndef countAllPostSocialCount():\n    import datetime\n    import time\n    now = datetime.datetime.utcnow()\n    #Only do the update when the tscore > 0 or the post is updated in the last two weeks\n    week2 = (now - datetime.timedelta(hours=24*14)).strftime(\'%Y-%m-%d %H:%M:%S+0000\')\n    rows = fbpl(( fbpl.post.tscore <> 0) | (fbpl.post.updated_time > week2 ) ).select(fbpl.post.fid,fbpl.post.from_id, orderby=fbpl.post.id)\n    start_date_time=datetime.datetime.today()\n\n    for row in rows:\n        gid= row.fid\n        from_id = row.from_id\n        #check if the Facebook has the graphic\n        getPostSocialCount(from_id,gid)\n\n\n    end_date_time=datetime.datetime.today()\n    fbpl.update_log.insert(start_date_time=start_date_time,end_date_time=end_date_time)\n    message = \'Successfully update socialcount of posts\'\n    return dict(message=message)\n\n#7\ndef teamCount():\n    errorMsg="success made the teamCount"\n    candidates = []\n    candidates.append("\xe9\x80\xa3\xe5\x8b\x9d\xe6\x96\x87")\n    candidates.append("\xe6\x9f\xaf\xe6\x96\x87\xe5\x93\xb2")\n    candidates.append("\xe9\xa1\xa7\xe7\xab\x8b\xe9\x9b\x84")\n    \n    results=OrderedDict()\n    try:\n        for candidate in candidates:\n\n            total_active_posts = 0\n            total_post_likes = 0\n            total_post_comments = 0\n            total_post_shares = 0\n            rows = fbpl( (fbpl.post.team == candidate ) & (fbpl.post.tscore > 0 )).select()\n            for row in rows:\n                total_post_likes += row.likes_count\n                total_post_comments += row.comment_count\n                total_post_shares += row.shares_count\n\n            total_active_posts = len(rows)\n#---------------------------------------------------------------------------------------------#\n            hour48_active_posts =0\n            hour48_post_likes = 0\n            hour48_post_comments = 0\n            hour48_post_shares = 0\n\n            rows = fbpl( ((fbpl.post.team == candidate) & ( fbpl.post.fscore > 0))  ).select()\n\n            for row in rows:\n                hour48_post_likes += row.likes_count48\n                hour48_post_comments += row.comment_count48\n                hour48_post_shares += row.shares_count48\n\n            hour48_active_posts = len(rows)\n\n#---------------------------------------------------------------------------------------------#\n            hour48_active_stories =0\n            hour48_story_likes = 0\n            hour48_story_comments = 0\n            hour48_story_shares = 0\n\n            rows = fbpl( ((fbpl.post.team == candidate) & ( fbpl.post.fscore > 0)) & ((fbpl.post.ptype == \'photo\') | ( fbpl.post.ptype == \'status\'))  ).select()\n            for row in rows:\n                hour48_story_likes += row.likes_count48\n                hour48_story_comments += row.comment_count48\n                hour48_story_shares += row.shares_count48\n\n            hour48_active_stories = len(rows)\n\n\n#---------------------------------------------------------------------------------------------#\n            hour48_active_links =0\n            hour48_link_likes = 0\n            hour48_link_comments = 0\n            hour48_link_shares = 0\n\n            rows = fbpl( ((fbpl.post.team == candidate) & ( fbpl.post.fscore > 0) &( fbpl.post.ptype == \'link\') ) ).select() #| ((fbpl.post.team == candidate) & (fbpl.post.created_time >= week ))\n            for row in rows:\n                hour48_link_likes += row.likes_count48\n                hour48_link_comments += row.comment_count48\n                hour48_link_shares += row.shares_count48\n\n            hour48_active_links = len(rows)\n\n#---------------------------------------------------------------------------------------------#\n            hour48_active_videos =0\n            hour48_video_likes = 0\n            hour48_video_comments = 0\n            hour48_video_shares = 0\n\n            rows = fbpl( ((fbpl.post.team == candidate) & ( fbpl.post.fscore > 0) &( fbpl.post.ptype == \'video\') )  ).select() #| ((fbpl.post.team == candidate) & (fbpl.post.created_time >= week ))\n            for row in rows:\n                hour48_video_likes += row.likes_count48\n                hour48_video_comments += row.comment_count48\n                hour48_video_shares += row.shares_count48\n\n            hour48_active_videos = len(rows)\n\n            date_time = datetime.datetime.utcnow().strftime(\'%Y%m%d\')\n            date_time = datetime.datetime.strptime(date_time, \'%Y%m%d\')\n            \n            checkins=0\n            likes=0\n            were_here_count=0\n            talking_about_count=0\n            checkins24=0\n            likes24=0\n            were_here_count24=0\n            talking_about_count24=0\n            \n            \n            Pages = fbpl(fbpl.page.team == candidate).select()\n            \n            for page in Pages:\n                \n                checkins += page.checkins\n                likes += page.likes\n                were_here_count += page.were_here_count\n                talking_about_count += page.talking_about_count\n                checkins24 += page.checkins24\n                likes24 += page.likes24\n                were_here_count24 += page.were_here_count24\n                talking_about_count24 += page.talking_about_count24\n\n            # check it team_counts has data in the same date, if YES, update the record, if NOT, then insert the new records.\n\n            row = fbpl( ((fbpl.team_counts.team == candidate)  & ( fbpl.team_counts.date_time == date_time))).select().first()\n            \n            if row:\n                row.update_record(checkins=checkins, likes=likes, were_here_count=were_here_count, talking_about_count=talking_about_count, total_active_posts=total_active_posts, total_post_likes=total_post_likes, total_post_comments=total_post_comments ,total_post_shares=total_post_shares, hour48_post_likes=hour48_post_likes, hour48_post_comments=hour48_post_comments, hour48_post_shares=hour48_post_shares, hour48_active_posts = hour48_active_posts, hour48_active_links =hour48_active_links, hour48_link_likes = hour48_link_likes, hour48_link_comments = hour48_link_comments, hour48_link_shares = hour48_link_shares, hour48_active_videos = hour48_active_videos, hour48_video_likes = hour48_video_likes, hour48_video_comments = hour48_video_comments, hour48_video_shares = hour48_video_shares, hour48_active_stories = hour48_active_stories, hour48_story_likes = hour48_story_likes, hour48_story_comments = hour48_story_comments, hour48_story_shares = hour48_story_shares, checkins24=checkins24, likes24=likes24, were_here_count24=were_here_count24, talking_about_count24=talking_about_count24)\n            else:\n                fbpl.team_counts.insert( team = candidate, date_time = date_time, checkins=checkins, likes=likes, were_here_count=were_here_count, talking_about_count=talking_about_count, total_active_posts=total_active_posts, total_post_likes=total_post_likes, total_post_comments=total_post_comments ,total_post_shares=total_post_shares, hour48_post_likes=hour48_post_likes, hour48_post_comments=hour48_post_comments, hour48_post_shares=hour48_post_shares, hour48_active_posts = hour48_active_posts, hour48_active_links =hour48_active_links, hour48_link_likes = hour48_link_likes, hour48_link_comments = hour48_link_comments, hour48_link_shares = hour48_link_shares, hour48_active_videos = hour48_active_videos, hour48_video_likes = hour48_video_likes, hour48_video_comments = hour48_video_comments, hour48_video_shares = hour48_video_shares, hour48_active_stories = hour48_active_stories, hour48_story_likes = hour48_story_likes, hour48_story_comments = hour48_story_comments, hour48_story_shares = hour48_story_shares, checkins24=checkins24, likes24=likes24, were_here_count24=were_here_count24, talking_about_count24=talking_about_count24)\n                fbpl.commit()\n            \n    except:\n        raise\n        #errorMsg=  "Unexpected error:", sys.exc_info()[0]\n    return errorMsg\n\n\n#8\ndef dailySum():\n    \n\n    \n    candidates = []\n    candidates.append("\xe9\x80\xa3\xe5\x8b\x9d\xe6\x96\x87")\n    candidates.append("\xe6\x9f\xaf\xe6\x96\x87\xe5\x93\xb2")\n    candidates.append("\xe9\xa1\xa7\xe7\xab\x8b\xe9\x9b\x84")\n    date = datetime.datetime.strptime("2014-04-29 00:00:00", \'%Y-%m-%d %H:%M:%S\')\n    \n    while date <= datetime.datetime.now():\n        #list=[]\n        for candidate in candidates:\n            dailyPagelikes=0\n            talkingAbout=0\n            dailyPosts = 0\n            dailyPostLikes=0\n            dailyPostComments=0\n            dailyPostShares=0\n            pages = fbpl(fbpl.page.team == candidate).select(fbpl.page.ALL)\n            date2 = date + datetime.timedelta(hours=24)\n            #date3 = date - datetime.timedelta(hours=24)\n            for page in pages:\n                likes1 = fbpl((fbpl.social_counts.placeid == page.pageid) & (fbpl.social_counts.updated_time >= date) ).select().first()\n                likes2 = fbpl((fbpl.social_counts.placeid == page.pageid) & (fbpl.social_counts.updated_time >= date2)).select().first()\n                \n                \n                \n                if likes1:\n                    if likes2 :\n                        dailyPagelikes += (likes2.likes - likes1.likes)\n                        talkingAbout += (likes1.talking_about_count + likes2.talking_about_count)/2\n                \n                post1 =  fbpl((fbpl.post.from_id == str(page.pageid))).select()\n                list= []\n                for post in post1:\n                    list = getPostCountDate(post.fid, date.strftime(\'%Y-%m-%d\'), date2.strftime(\'%Y-%m-%d\'))\n                   \n                    dailyPostLikes = dailyPostLikes +  list[0]\n                    dailyPostComments =  dailyPostComments  +  list[1]\n                    dailyPostShares = dailyPostShares  +  list[2]\n                    \n                    \n            Posts = fbpl((fbpl.post.team == candidate) & (fbpl.post.status_type <> \'\') & (fbpl.post.created_time >= date) & (fbpl.post.created_time < date2) ).select()\n            dailyPosts =len(Posts)\n            \n            row = fbpl((fbpl.dailySum.date == date) & (fbpl.dailySum.team == candidate) ).select().first()\n            if row:\n                row.update_record(dailyPagelikes=dailyPagelikes, talkingAbout=talkingAbout,team=candidate, dailyPosts=dailyPosts, dailyPostLikes=dailyPostLikes, dailyPostComments=dailyPostComments, dailyPostShares=dailyPostShares)\n            else:\n                fbpl.dailySum.insert(date=date,dailyPagelikes=dailyPagelikes, talkingAbout=talkingAbout,team=candidate, dailyPosts=dailyPosts, dailyPostLikes=dailyPostLikes, dailyPostComments=dailyPostComments, dailyPostShares=dailyPostShares)\n                fbpl.commit()\n        date += datetime.timedelta(hours=24) \n    return "OK"\n\n\n\n#Field(\'dailyPagelikes\',\'integer\'), Field(\'talkingAbout\',\'integer\'), Field(\'dailyPosts\',\'integer\'),Field(\'dailyPostLikes\',\'integer\'), #Field(\'dailyPostComments\',\'integer\'), Field(\'dailyPostShares\',\'integer\')\n\n\n\ndef test2():\n    now= datetime.datetime.utcnow()\n    #month2 = (now - datetime.timedelta(hours=24*28*2)).strftime(\'%Y-%m-%dT%H:%M:%S\') #2014-04-24T17:57:21+0000\n    #hour48 = (now - datetime.timedelta(hours=72)).strftime(\'%Y-%m-%d %H:%M:%S\')\n    #hour48 = datetime.datetime.strptime(hour48,\'%Y-%m-%d %H:%M:%S\')\n    #now= datetime.datetime.utcnow()\n    #week2 = (now - datetime.timedelta(hours=24*14)).strftime(\'%Y-%m-%dT%H:%M:%S+0000\') #2014-04-24T17:57:21+0000\n    #month2 = datetime.datetime.strptime(month2,\'%Y-%m-%dT%H:%M:%S+0000\')\n    now = datetime.datetime.utcnow()\n    week2 = (now - datetime.timedelta(hours=24*14)).strftime(\'%Y-%m-%d %H:%M:%S+0000\')\n    rows = fbpl(( fbpl.post.tscore <> 0) | (fbpl.post.created_time > week2 ) ).select(fbpl.post.fid)\n\n    #row = fbpl(fbpl.post.created_time >= week2).select(fbpl.post.ALL).first()\n    return str(rows) #row.date_time\n\n\n\ndef hourdiff(now, hour):\n    hour = (now - datetime.timedelta(hours=hour)).strftime(\'%Y-%m-%d %H:%M:%S\')\n    hour = datetime.datetime.strptime(hour,\'%Y-%m-%d %H:%M:%S\')\n\n    return hour\n\n\n\n\ndef getOpengraphImage(url):\n    op={}\n    image=\'\'\n    if (url and url<>""):\n        try:\n            op = ExtendedOpenGraph.parse(url)\n            image = op[\'image\']\n        except:\n            image=\'\'\n    return image\n\n\n@auth.requires_login()\ndef index():\n    user = auth.user\n    response.flash = T(\'You are %(name)s\', dict(name=user[\'first_name\']))\n    if  len(request.args) >= 2 and request.args[0] == \'id\':\n        fb_id = request.args[1]\n    else:\n        fb_id = \'me\'\n\n    graph = getGraph()\n    try:\n        fb_obj = graph.get_object(fb_id, metadata=1)\n    except GraphAPIError, e:\n        response.flash = "%s [%s: %s]" % (T("Logging you out!"),__name__, e)\n        redirect(auth.url(f=\'user\', args=\'logout\'))\n\n    response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=T(\'You are at  %(fb_id)s\', dict(fb_id=fb_id)))\n\n@auth.requires_login()\ndef connection():\n    user = auth.user\n    if not len(request.args) >= 2:\n        return None\n    fb_id = request.args[0]\n    fb_connection_name = request.args[1]\n    try:\n        connections = getGraph().get_connections(fb_id, fb_connection_name)\n    except GraphAPIError, e:\n        response.flash = "%s [%s: %s]" % (T("Logging you out!"),__name__, e)\n        redirect(auth.url(f=\'user\', args=\'logout\'))\n\n\n    response.menu=[[v[\'name\'], False, URL(r=request, f=\'index\', args=[\'id\', v[\'id\']])]  for v in connections[\'data\']]\n    return dict(message=T(\'Looking list of %(conn_name)s of %(id)s\', dict(conn_name=fb_connection_name, id=fb_id)))\n\n\n\n\n@auth.requires_login()\ndef loading_list():\n    user = auth.user\n    import csv, sys\n    import datetime\n    import time\n\n    graph = getGraph()\n    reader = open(\'/Users/logyuan/Dropbox/FB_socialcount/keelung.csv\', "U")\n    errorMsg = \'\'\n    for fbplace in csv.reader(reader):\n        try:\n            id = str(fbplace[0])\n            row = fbpl.place(placeid=id)\n            if not row:\n                try:\n                    fb_obj = graph.get_object(str(fbplace[0]))\n                    #id= fb_obj["id"]\n                    name =  fb_obj["name"]\n                    category = fb_obj["category"]\n                    link= fb_obj["link"]\n                    #checkins= fb_obj["checkins"]\n                    zip= fb_obj["location"]["zip"]\n                    try:\n                        category_list =  fb_obj["category_list"]\n                    except:\n                        category_list = \'\'\n                    try:\n                        latitude= fb_obj["location"]["latitude"]\n                        longitude= fb_obj["location"]["longitude"] if (fb_obj["location"]["longitude"]) else ""\n                    except:\n                        latitude =\'\'\n                        longitude=\'\'\n                    fbpl.place.insert(placeid=id,name = name,latitude=latitude,longitude=longitude,category=category,category_list=category_list,zip=zip,link=link)\n                except GraphAPIError, e:\n                    errorMsg = errorMsg + \'errorID:\'  + str(fbplace[0]) + \'errorMessage: \' +  str(e) + \',\'\n                fbpl.commit()\n                message=\'Successfully adding new place into the database\'\n\n                time.sleep(8)\n        except GraphAPIError, e:\n            errorMsg = errorMsg + \'errorID:\'  + str(fbplace[0])  + \' errorMessage:\'  +  str(e) + \',\'\n    reader.close()\n        # or "rU"\n\n    return dict(message=T(\'list complete\'),errorMsg=errorMsg )\n\n\n\n\n@auth.requires_login()\ndef getPost(gid):\n    graph = getGraph()\n    try:\n        if gid:\n            fb_obj = graph.request(gid,args={\'fields\': \'id, message, updated_time, from, created_time, status_type, type, link, likes.limit(1).summary(true), shares, comments.limit(1).summary(true), object_id, picture\'})\n            fid= fb_obj["id"]\n            message =  fb_obj["message"] if (\'message\' in fb_obj) else \'\'\n            created_time = datetime.datetime.strptime(fb_obj["created_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'created_time\' in fb_obj) else \'\'\n            updated_time = datetime.datetime.strptime(fb_obj["updated_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'updated_time\' in fb_obj) else \'\'\n            from_id = fb_obj["from"]["id"] if (\'from\' in fb_obj) else \'\'\n            from_name = fb_obj["from"]["name"] if (\'from\' in fb_obj) else \'\'\n            status_type = fb_obj["status_type"] if (\'status_type\' in fb_obj) else \'\'\n            ptype = fb_obj["type"] if (\'type\' in fb_obj) else \'\'\n            status_type = fb_obj["status_type"] if (\'status_type\' in fb_obj) else \'\'\n            link =  fb_obj["link"] if (\'link\' in fb_obj) else \'\'\n            #picture =  fb_obj["picture"] if (\'picture\' in fb_obj) else \'\'\n            shares_count = fb_obj["shares"][\'count\'] if (\'shares\' in fb_obj) else 0\n            likes_count = fb_obj["likes"]["summary"]["total_count"] if (\'summary\' in fb_obj) else 0\n            comment_count = fb_obj["comments"]["summary"]["total_count"] if (\'summary\' in fb_obj) else 0\n            object_id = fb_obj["object_id"] if (\'object_id\' in fb_obj) else \'\'\n            row=fbpl(fbpl.page.pageid==from_id).select().first()\n            team = row[\'team\']\n            if (ptype == \'link\' ) | (ptype == \'video\'):\n                try:\n                    picture =getOpengraphImage(link)\n                    if picture == \'\':\n                        picture = post["picture"] if (\'picture\' in post) else \'\'\n                except:\n                    picture = post["picture"] if (\'picture\' in post) else \'\'\n            elif (ptype == \'photo\' ) :\n                try:\n                    images=[]\n                    images =graph.request(object_id , args={\'fields\':\'images\'})["images"]\n                    for image in images:\n                        if (image["height"] > 200):\n                            picture = image["source"]\n                except:\n                    picture = post["picture"] if (\'picture\' in post) else \'\'\n            else:\n                picture = post["picture"] if (\'picture\' in post) else \'\'\n\n\n            row = fbpl(fbpl.post.fid==from_id).select().first()\n            if row:\n                row.update_record(fid=fid, message=message,from_id=from_id, from_name=from_name, created_time=created_time,object_id=object_id,ptype=ptype,status_type=status_type, link=link, picture=picture ,shares_count=shares_count,likes_count=likes_count,comment_count=comment_count,team=team, updated_time=updated_time)\n            else:\n                fbpl.post.insert(fid=fid, message=message,from_id=from_id, from_name=from_name, created_time=created_time,object_id=object_id,ptype=ptype,status_type=status_type, link=link, picture=picture ,shares_count=shares_count,likes_count=likes_count,comment_count=comment_count,team=team, updated_time=updated_time)\n                fbpl.commit()\n            message=\'Successfully adding new post into the database\'\n        else:\n            message=\'failure, please check your postid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=gid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n\n@auth.requires_login()\ndef getPage(gid,team):\n    graph = getGraph()\n    try:\n        if gid:\n            fb_obj = graph.request(gid ,args={\'fields\': \'id, name, category, about, can_post, checkins, talking_about_count, were_here_count, link,description, cover, website, picture.type(large), is_published,likes.limit(1).summary(true), insights\'})\n            id= fb_obj["id"]\n            pageid = fb_obj["id"]\n            name =  fb_obj["name"] if (\'name\' in fb_obj) else \'\'\n            category = fb_obj["category"] if (\'category\' in fb_obj) else \'\'\n            about = fb_obj["about"] if (\'about\' in fb_obj) else \'\'\n            can_post = fb_obj["can_post"] if (\'can_post\' in fb_obj) else \'\'\n            is_published = fb_obj["is_published"] if (\'is_published\' in fb_obj) else \'\'\n            talking_about_count = fb_obj["talking_about_count"] if (\'talking_about_count\' in fb_obj) else 0\n            were_here_count = fb_obj["were_here_count"] if (\'were_here_count\' in fb_obj) else 0\n            link = fb_obj["link"] if (\'link\' in fb_obj) else \'\'\n            likes = fb_obj["likes"] if (\'likes\' in fb_obj) else \'\'\n            description = fb_obj["description"] if (\'description\' in fb_obj) else \'\'\n            cover_id = fb_obj["cover"]["cover_id"] if (\'cover\' in fb_obj) else \'\'\n            source = fb_obj["cover"]["source"] if (\'cover\' in fb_obj) else \'\'\n            picture = fb_obj["picture"]["data"]["url"] if (\'picture\' in fb_obj) else \'\'\n            team=team\n            website = fb_obj["website"] if (\'website\' in fb_obj) else \'\'\n            row = fbpl(fbpl.page.pageid==id).select().first()\n            if row :\n                row.update_record(name=name, category=category, about=about, can_post=can_post, is_published=is_published, link=link, description=description, cover_id=cover_id, source=source,website=website,talking_about_count=talking_about_count,were_here_count=were_here_count,picture=picture,team=team)\n            else:\n                fbpl.page.insert(pageid=pageid,name=name, category=category, about=about, can_post=can_post, is_published=is_published, link=link, description=description, cover_id=cover_id, source=source,website=website,talking_about_count=talking_about_count,were_here_count=were_here_count,picture=picture,team=team)\n            fbpl.commit()\n            message=\'Successfully adding new page into the database\'\n        else:\n            message=\'failure, please check your pageid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=gid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@auth.requires_login()\ndef getPlace(gid):\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        gid = checkGraphId(gid)\n        if gid <> \'0\':\n            fb_obj = graph.get_object(gid)\n            row = fbpl.place(placeid=gid)\n            if not row:\n                name =  fb_obj["name"] if (\'name\' in fb_obj) else \'\'\n                category = fb_obj["category"] if (\'category\' in fb_obj) else \'\'\n                category_list =  fb_obj["category_list"] if (\'category_list\' in fb_obj) else \'\'\n                link= fb_obj["link"] if (\'link\' in fb_obj) else \'\'\n                website =fb_obj["website"] if (\'website\' in fb_obj) else \'\'\n                phone =fb_obj["phone"] if (\'phone\' in fb_obj) else \'\'\n                description =fb_obj["description"] if (\'description\' in fb_obj) else \'\'\n\n                if (\'location\' in fb_obj):\n                    zip= fb_obj["location"]["zip"] if (\'zip\' in fb_obj["location"]) else \'\'\n                    street= fb_obj["location"]["street"] if (\'street\' in fb_obj["location"]) else \'\'\n                    city= fb_obj["location"]["city"] if (\'city\' in fb_obj["location"]) else \'\'\n                    state= fb_obj["location"]["state"] if (\'state\' in fb_obj["location"]) else \'\'\n                    country=fb_obj["location"]["country"] if (\'country\' in fb_obj["location"]) else \'\'\n                    latitude= fb_obj["location"]["latitude"] if (\'latitude\' in fb_obj["location"]) else \'\'\n                    longitude= fb_obj["location"]["longitude"] if (\'longitude\' in fb_obj["location"]) else \'\'\n                    mutiple = \'No\'\n                else:\n                    zip= \'\'\n                    street= \'\'\n                    city= \'\'\n                    state= \'\'\n                    country= \'\'\n                    latitude= \'\'\n                    longitude= \'\'\n                old_ids = \'\'\n                fbpl.place.insert(placeid=gid,name = name,latitude=latitude,longitude=longitude,category=category,category_list=category_list,zip=zip,link=link,old_ids=old_ids)\n\n            fbpl.commit()\n            message=\'Successfully adding new place into the database\'\n        else:\n            message=\'failure, please check your placeid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=gid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n\n@auth.requires_login()\ndef getPlace_f():\n    graph = getGraph()\n    try:\n        if request.vars[\'gid\']:\n            gid = request.vars[\'gid\']\n            fb_obj = graph.get_object(gid)\n            id= fb_obj["id"]\n            row = fbpl.place(placeid=id)\n            if not row:\n                name =  fb_obj["name"]\n                category = fb_obj["category"]\n                category_list =  fb_obj["category_list"]\n                checkins= fb_obj["checkins"]\n                zip= fb_obj["location"]["zip"]\n                latitude= fb_obj["location"]["latitude"]\n                longitude= fb_obj["location"]["longitude"]\n                link= fb_obj["link"]\n                old_ids = \'\'\n                fbpl.place.insert(placeid=id,name = name,latitude=latitude,longitude=longitude,category=category,category_list=category_list,zip=zip,link=link,old_ids=old_ids)\n\n            fbpl.commit()\n            message=\'Successfully adding new place into the database\'\n        else:\n            message=\'failure, please check your placeid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n@auth.requires_login()\ndef getEvent(eid):\n    graph = getGraph()\n    try:\n        event= graph.get_object(eid)\n        eventid = event["id"] if \'id\' in event else \'\'\n        row = fbpl.event(eventid=eventid)\n        if not row:\n            description = event["description"] if \'description\' in event else \'\'\n            end_time  = event["end_time"] if \'end_time\' in event else \'\'\n            timezone = event["timezone"] if \'timezone\' in event else \'\'\n            name = event["name"] if \'name\' in event else \'\'\n            location = event["location"] if \'location\' in event else \'\'\n            ownerid = event["owner"]["id"] if \'owner\' in event else \'\'\n            picture = event["picture"] if \'picture\' in event else \'\'\n            privacy = event["privacy"] if \'privacy\' in event else \'\'\n            start_time = event["start_time"] if \'start_time\' in event else \'\'\n            ticket_uri = event["ticket_uri"] if \'ticket_uri\' in event else \'\'\n            updated_time = event["updated_time"] if \'updated_time\' in event else \'\'\n            is_date_only  = event["is_date_only"] if \'is_date_only\' in event else \'\'\n            if \'venue\' in event:\n                venueid  = event["venue"]["id"] if \'id\' in event["venue"] else \'\'\n                venuename = event["venue"]["name"] if \'name\' in event["venue"] else \'\'\n                country = event["venue"]["country"] if \'country\' in event["venue"] else \'\'\n                city = event["venue"]["city"] if \'city\' in event["venue"] else \'\'\n                state  = event["venue"]["state"] if \'state\' in event["venue"] else \'\'\n                street = event["venue"]["street"] if \'street\' in event["venue"] else \'\'\n                zipcode = event["venue"]["zip"] if \'zip\' in event["venue"] else \'\'\n                longitude = event["venue"]["longitude"] if \'longitude\' in event["venue"] else \'\'\n                latitude  = event["venue"]["latitude"] if \'latitude\' in event["venue"] else \'\'\n            fbpl.event.insert(eventid=eventid, description=description, end_time=end_time, timezone=timezone, name=name, location=location, ownerid=ownerid, picture=picture, privacy=privacy, start_time=start_time, ticket_uri=ticket_uri, updated_time=updated_time, is_date_only=is_date_only, venuename=venuename, venueid=venueid, country=country, city=city, state=state, street=street, zipcode=zipcode, longitude=longitude, latitude=latitude)\n            fbpl.commit()\n            message=\'Successfully adding new event into the database\'\n        else:\n            message=\'failure, please check your eventid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=eventid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n    return dict(message=message)\n\n@auth.requires_login()\ndef getSocialCount():\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        if request.vars[\'gid\']:\n            oid = request.vars[\'gid\']\n        else:\n            message=\'failure, please check your placeid!\'\n            return dict(message=message)\n        pid = checkGraphId(oid)\n        if pid <> \'0\':\n            if pid <> oid :\n                record = fbpl(fbpl.place.placeid==oid).select().first()\n                record2 = fbpl(fbpl.place.placeid==pid).select().first()\n                if not (record2) :\n                   getPlace(pid)\n                   time.sleep(1)\n                   record2 = fbpl(fbpl.place.placeid==pid).select().first()\n                   oids = []\n                   oids.append(oid)\n                   record2.update_record(old_ids=oids)\n                   fbpl(fbpl.place.placeid==oid).delete()\n                else:\n                   fbpl(fbpl.place.placeid==oid).delete()\n                   oids = []\n                   oids.append(record2.old_ids)\n                   oids.append(oid)\n                   record2.update_record(old_ids=oids)\n            fb_obj = graph.get_object(pid)\n            try:\n                checkins =  fb_obj["checkins"]\n            except:\n                checkins=\'\'\n            try:\n                likes= fb_obj["likes"]\n            except:\n                likes=\'\'\n            try:\n                were_here_count= fb_obj["were_here_count"]\n            except:\n                were_here_count=\'\'\n            date_time = datetime.datetime.utcnow()\n            fbpl.social_counts.insert(placeid=pid,checkins = checkins,likes=likes,date_time=date_time,were_here_count=were_here_count)\n            fbpl.commit()\n            time.sleep(1.1)\n            message=\'Successfully found the place\'\n            return dict(message=message)\n        else:\n            return dict(message=\'failure, please check your placeid!\')\n\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n    #response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=message)  #dict(message=str[9])\n\n@auth.requires_login()\ndef getSocialCount_f(gid):\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        if gid:\n            oid = gid\n        else:\n            message=\'failure, please check your placeid!\'\n            return dict(message=message)\n        pid = checkGraphId(oid)\n        if pid <> \'0\':\n            if pid <> oid :\n                record = fbpl(fbpl.place.placeid==oid).select().first()\n                record2 = fbpl(fbpl.place.placeid==pid).select().first()\n                if not (record2) :\n                    getPlace(pid)\n                    time.sleep(1)\n                    record2 = fbpl(fbpl.place.placeid==pid).select().first()\n                    oids = []\n                    oids.append(oid)\n                    record2.update_record(old_ids=oids)\n                    fbpl(fbpl.place.placeid==oid).delete()\n                else:\n                   fbpl(fbpl.place.placeid==oid).delete()\n                   oids = []\n                   oids.append(record2.old_ids)\n                   oids.append(oid)\n                   record2.update_record(old_ids=oids)\n            fb_obj = graph.get_object(pid)\n            try:\n                checkins =  fb_obj["checkins"]\n            except:\n                checkins=\'\'\n            try:\n                likes= fb_obj["likes"]\n            except:\n                likes=\'\'\n            try:\n                were_here_count= fb_obj["were_here_count"]\n            except:\n                were_here_count=\'\'\n            date_time = datetime.datetime.today()\n            fbpl.social_counts.insert(placeid = pid, checkins = checkins,likes=likes,date_time=date_time,were_here_count=were_here_count)\n            fbpl.commit()\n            time.sleep(1.1)\n            message=\'Successfully found the place\'\n            return dict(message=message)\n        else:\n            return dict(message=\'failure, please check your placeid!\')\n\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n    except:\n        raise\n\n    #response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=message)  #dict(message=str[9])\n\n\n\n\n\n@auth.requires_login()\ndef checkGraphId_f():\n    import datetime\n    import time\n    graph = getGraph()\n    if request.vars[\'gid\']:\n        graphid = request.vars[\'gid\']\n    else:\n        return dict(message=\'failure, please check your placeid!\')\n\n    new_graphid = graphid\n    try:\n        fb_obj = graph.get_object(graphid)\n    except GraphAPIError, r:\n        message=r.result\n        code =message[\'error\'][\'code\']\n        fbpl.graphAPI_Error.insert(placeid=graphid,date_time=datetime.datetime.today(),code =code,error_msg=message)\n        fbpl.commit()\n        if code == 21:\n            id=message[\'error\'][\'message\'].split(\' \')\n            new_graphid = id[9].strip(\'.\')\n            try:\n                fb_obj = graph.get_object(new_graphid)\n            except GraphAPIError, e:\n                time.sleep(1)\n                new_graphid = checkGraphId(new_graphid)\n            try:\n                row = fbpl.place(placeid=graphid)\n                fbpl.merged_place.insert(placeid=graphid,date_time=datetime.datetime.today(),merge_to = new_graphid,name = row.name, latitude=row.latitude,longitude=row.longitude,category=row.category,category_list=row.category_list,zip=row.zip,link=row.link,old_ids=row.old_ids)\n            except:\n                message = \'No this id in the DB\'\n        else:\n            new_graphid = \'0\'\n\n    return new_graphid\n\n\n\n\n@auth.requires_login()\ndef checkGraphId(graphid):\n    import datetime\n    import time\n    graph = getGraph()\n    new_graphid = graphid\n    try:\n        fb_obj = graph.get_object(graphid)\n    except GraphAPIError, r:\n        message=r.result\n        code =message[\'error\'][\'code\']\n        fbpl.graphAPI_Error.insert(placeid=graphid,date_time=datetime.datetime.today(),code =code,error_msg=message)\n        fbpl.commit()\n        if code == 21:\n            id=message[\'error\'][\'message\'].split(\' \')\n            new_graphid = id[9].strip(\'.\')\n            try:\n                fb_obj = graph.get_object(new_graphid)\n            except GraphAPIError, e:\n                time.sleep(1)\n                new_graphid = checkGraphId(new_graphid)\n            try:\n                row = fbpl.place(placeid=graphid)\n                fbpl.merged_place.insert(placeid=graphid,date_time=datetime.datetime.today(),merge_to = new_graphid,name = row.name, latitude=row.latitude,longitude=row.longitude,category=row.category,category_list=row.category_list,zip=row.zip,link=row.link,old_ids=row.old_ids)\n            except:\n                message = \'No this id in the DB\'\n        else:\n            new_graphid = \'0\'\n\n    return new_graphid\n\n\n@auth.requires_login()\ndef countAllPlaceSocialCount():\n    import datetime\n    import time\n\n    graph = getGraph()\n    rows = fbpl().select(fbpl.place.placeid,fbpl.place.old_ids, orderby=fbpl.place.id)\n    start_date_time=datetime.datetime.today()\n\n    for row in rows:\n        pid= row.placeid\n        #check if the Facebook has the graphic\n        getSocialCount_f(pid)\n\n    end_date_time=datetime.datetime.today()\n    fbpl.update_log.insert(start_date_time=start_date_time,end_date_time=end_date_time)\n    message = \'Successfully update socialcount of places\'\n    return dict(message=message)\n\n\n\n\n\n\n\n\n\n@auth.requires_login()\ndef countTscore():\n    #fbpl(fbpl.post.id>0).update(tscore= fbpl.post.likes_count*0.2+fbpl.post.shares_count*0.5+fbpl.post.comment_count*0.3)\n    rows= fbpl().select(fbpl.post.ALL)\n    for row in rows:\n        tscore = row.shares_count*0.5 + row.comment_count*0.3 + row.likes_count*0.2\n        row.update_record(tscore=tscore)\n    return "success"\n\n\n\n@auth.requires_login()\ndef getPageCount(fid, hour, day):\n\n    now = datetime.datetime.now()\n    hours = hour + day*24\n    from_date = hourdiff(now,hours)\n\n    rows = fbpl((fbpl.social_counts.placeid==fid) & (fbpl.social_counts.date_time >= from_date )).select( orderby= ~fbpl.social_counts.date_time)\n    if rows:\n        total_page_checkins= rows.first()[\'checkins\'] - rows.last()[\'checkins\']\n        total_page_likes = rows.first()[\'likes\'] - rows.last()[\'likes\']\n        total_page_whc = rows.first()[\'were_here_count\'] - rows.last()[\'were_here_count\']\n        total_page_tac = rows.first()[\'talking_about_count\'] - rows.last()[\'talking_about_count\']\n    else:\n        total_page_checkins= 0\n        total_page_likes = 0\n        total_page_whc = 0\n        total_page_tac = 0\n    result = [total_page_checkins,total_page_likes,total_page_whc,total_page_tac]\n    return result\n\n\n\n@auth.requires_login()\ndef getPostCount(fid, hour, day):\n    #fid, hour, day\n    #hour =96\n    #day = 0\n    #fid = \'466328090135843\'\n\n    now = datetime.datetime.now()\n    hours = hour + day*24\n    from_date = hourdiff(now,hours)\n\n    rows = fbpl((fbpl.post_counts.fid==fid) & (fbpl.post_counts.date_time >= from_date )).select( orderby= ~fbpl.post_counts.date_time)\n    if rows:\n        total_post_likes = rows.first()[\'likes_count\'] - rows.last()[\'likes_count\']\n        total_post_comments = rows.first()[\'comment_count\'] - rows.last()[\'comment_count\']\n        total_post_shares = rows.first()[\'shares_count\'] - rows.last()[\'shares_count\']\n    else:\n        total_post_likes = \'\'\n        total_post_comments = \'\'\n        total_post_shares = \'\'\n    result = [total_post_likes,total_post_comments,total_post_shares]\n    return result\n\n\n\n@auth.requires_login()\ndef getPageCountDate(fid, from_date, to_date):\n    #fid, from_date, to_date\n    #fid = \'543656759040101\'\n    #from_date = \'2014-4-25\'\n    #to_date = \'2014-4-30\'\n    from_date = datetime.datetime.strptime(from_date,\'%Y-%m-%d\')\n    to_date = datetime.datetime.strptime(to_date,\'%Y-%m-%d\')\n\n    rows = fbpl((fbpl.social_counts.placeid==fid) & (fbpl.social_counts.date_time >= from_date ) & (fbpl.social_counts.date_time <= to_date )).select()\n\n    if rows:\n        total_page_checkins= rows.first()[\'checkins\'] - rows.last()[\'checkins\']\n        total_page_likes = rows.first()[\'likes\'] - rows.last()[\'likes\']\n        total_page_whc = rows.first()[\'were_here_count\'] - rows.last()[\'were_here_count\']\n        total_page_tac = (rows.first()[\'talking_about_count\'] + rows.last()[\'talking_about_count\'])/2\n    else:\n        total_page_checkins=\'\'\n        total_page_likes = \'\'\n        total_page_whc = \'\'\n        total_page_tac = \'\'\n\n    result = [total_page_checkins,total_page_likes,total_page_whc,total_page_tac]\n    return result\n\n@auth.requires_login()\ndef getPostCountDate(fid, from_date, to_date):\n\n    from_date = datetime.datetime.strptime(from_date,\'%Y-%m-%d\')\n    to_date = datetime.datetime.strptime(to_date,\'%Y-%m-%d\')\n\n    rows = fbpl((fbpl.post_counts.fid==fid) & (fbpl.post_counts.updated_time >= from_date ) ).select()\n    rows1 = fbpl((fbpl.post_counts.fid==fid) & (fbpl.post_counts.updated_time >= to_date )).select()\n    if rows:\n        if rows1:\n            total_post_likes = rows1.first()[\'likes_count\'] - rows.first()[\'likes_count\']\n            total_post_comments = rows1.first()[\'comment_count\'] - rows.first()[\'comment_count\']\n            total_post_shares = rows1.first()[\'shares_count\'] - rows.first()[\'shares_count\']\n        else:\n            total_post_likes = rows.last()[\'likes_count\'] - rows.first()[\'likes_count\']\n            total_post_comments = rows.last()[\'comment_count\'] - rows.first()[\'comment_count\']\n            total_post_shares = rows.last()[\'shares_count\'] - rows.first()[\'shares_count\']            \n    else:\n        total_post_likes = 0\n        total_post_comments = 0\n        total_post_shares = 0\n\n    result = [total_post_likes,total_post_comments,total_post_shares]\n    return result\n\nresponse._vars=response._caller(postCount)\n'
p7
sS'snapshot'
p8
(dp9
S'exception'
p10
(dp11
S'__module__'
p12
S"'bson.errors'"
p13
sS'__getslice__'
p14
S"<method-wrapper '__getslice__' of InvalidDocument object>"
p15
sS'__str__'
p16
S"<method-wrapper '__str__' of InvalidDocument object>"
p17
sS'__reduce__'
p18
S'<built-in method __reduce__ of InvalidDocument object>'
p19
sS'__dict__'
p20
S'{}'
p21
sS'__sizeof__'
p22
S'<built-in method __sizeof__ of InvalidDocument object>'
p23
sS'__weakref__'
p24
S'None'
p25
sS'__init__'
p26
S"<method-wrapper '__init__' of InvalidDocument object>"
p27
sS'__setattr__'
p28
S"<method-wrapper '__setattr__' of InvalidDocument object>"
p29
sS'__reduce_ex__'
p30
S'<built-in method __reduce_ex__ of InvalidDocument object>'
p31
sS'__new__'
p32
S'<built-in method __new__ of type object>'
p33
sS'__format__'
p34
S'<built-in method __format__ of InvalidDocument object>'
p35
sS'__class__'
p36
S"<class 'bson.errors.InvalidDocument'>"
p37
sS'__doc__'
p38
S"'Raised when trying to create a BSON object from an invalid document.\\n    '"
p39
sS'__getitem__'
p40
S"<method-wrapper '__getitem__' of InvalidDocument object>"
p41
sS'__setstate__'
p42
S'<built-in method __setstate__ of InvalidDocument object>'
p43
sS'__getattribute__'
p44
S"<method-wrapper '__getattribute__' of InvalidDocument object>"
p45
sS'args'
p46
S"('Cannot encode object: datetime.timedelta(1)',)"
p47
sS'__subclasshook__'
p48
S'<built-in method __subclasshook__ of type object>'
p49
sS'__unicode__'
p50
S'<built-in method __unicode__ of InvalidDocument object>'
p51
sS'__delattr__'
p52
S"<method-wrapper '__delattr__' of InvalidDocument object>"
p53
sS'__repr__'
p54
S"<method-wrapper '__repr__' of InvalidDocument object>"
p55
sS'__hash__'
p56
S"<method-wrapper '__hash__' of InvalidDocument object>"
p57
ssS'evalue'
p58
S'Cannot encode object: datetime.timedelta(1)'
p59
sS'request'
p60
cgluon.html
XML_unpickle
p61
(S's\xdeV\x00\x00<div><table><tr><td style="font-weight:bold;vertical-align:top;">ajax</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">application</td><td style="vertical-align:top;">:</td><td><div>fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">args</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cid</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">client</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">controller</td><td style="vertical-align:top;">:</td><td><div>graphAPI</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cookies</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">session_id_admin</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1-2a34b6e8-7adc-42f3-a1be-7dc754917077<table><tr><td style="font-weight:bold;vertical-align:top;">comment</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">domain</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">expires</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">httponly</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">max-age</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">path</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">secure</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">version</td><td style="vertical-align:top;">:</td><td><div></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_id_fbmayor</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93<table><tr><td style="font-weight:bold;vertical-align:top;">comment</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">domain</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">expires</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">httponly</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">max-age</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">path</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">secure</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">version</td><td style="vertical-align:top;">:</td><td><div></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">env</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">HTTP_ACCEPT</td><td style="vertical-align:top;">:</td><td><div>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_ACCEPT_ENCODING</td><td style="vertical-align:top;">:</td><td><div>gzip, deflate</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_ACCEPT_LANGUAGE</td><td style="vertical-align:top;">:</td><td><div>en-us</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_CONNECTION</td><td style="vertical-align:top;">:</td><td><div>keep-alive</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_COOKIE</td><td style="vertical-align:top;">:</td><td><div>session_id_admin=127.0.0.1-2a34b6e8-7adc-42f3-a1be-7dc754917077; session_id_fbmayor=127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_DNT</td><td style="vertical-align:top;">:</td><td><div>1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_HOST</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1:8088</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_USER_AGENT</td><td style="vertical-align:top;">:</td><td><div>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/537.75.14</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">PATH_INFO</td><td style="vertical-align:top;">:</td><td><div>/fbmayor/graphAPI/postCount</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">QUERY_STRING</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">REMOTE_ADDR</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">REMOTE_PORT</td><td style="vertical-align:top;">:</td><td><div>56982</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">REQUEST_METHOD</td><td style="vertical-align:top;">:</td><td><div>GET</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SCRIPT_NAME</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SERVER_NAME</td><td style="vertical-align:top;">:</td><td><div>maclogair.local</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SERVER_PORT</td><td style="vertical-align:top;">:</td><td><div>8088</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SERVER_PROTOCOL</td><td style="vertical-align:top;">:</td><td><div>HTTP/1.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SERVER_SOFTWARE</td><td style="vertical-align:top;">:</td><td><div>Rocket 1.2.6</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">app_folders</td><td style="vertical-align:top;">:</td><td><div>set([&#x27;/Applications/web2py.app/Contents/Resources/applications/fbmayor/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/fb_event/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/admin/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/welcome/&#x27;])</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">applications_parent</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cmd_args</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cmd_options</td><td style="vertical-align:top;">:</td><td><div>&lt;Values at 0x104201d40: {&#x27;verbose&#x27;: False, &#x27;ip&#x27;: &#x27;127.0.0.1&#x27;, &#x27;debuglevel&#x27;: 30, &#x27;with_scheduler&#x27;: False, &#x27;ips&#x27;: [&#x27;fe80::60c:ceff:fee3:df4a%en0&#x27;, &#x27;192.168.100.4&#x27;], &#x27;shutdown_timeout&#x27;: 5, &#x27;taskbar&#x27;: False, &#x27;with_coverage&#x27;: False, &#x27;port&#x27;: 8000, &#x27;maxthreads&#x27;: None, &#x27;softcron&#x27;: False, &#x27;server_name&#x27;: &#x27;maclogair.local&#x27;, &#x27;bpython&#x27;: False, &#x27;nogui&#x27;: False, &#x27;pid_filename&#x27;: &#x27;httpserver.pid&#x27;, &#x27;extcron&#x27;: False, &#x27;runcron&#x27;: False, &#x27;run_system_tests&#x27;: False, &#x27;test&#x27;: None, &#x27;folder&#x27;: &#x27;/Applications/web2py.app/Contents/Resources&#x27;, &#x27;config&#x27;: &#x27;&#x27;, &#x27;minthreads&#x27;: None, &#x27;shell&#x27;: None, &#x27;run&#x27;: &#x27;&#x27;, &#x27;log_filename&#x27;: &#x27;httpserver.log&#x27;, &#x27;profiler_dir&#x27;: None, &#x27;args&#x27;: [&#x27;&#x27;], &#x27;socket_timeout&#x27;: 5, &#x27;ssl_ca_certificate&#x27;: None, &#x27;scheduler&#x27;: None, &#x27;interfaces&#x27;: None, &#x27;ssl_private_key&#x27;: &#x27;&#x27;, &#x27;scheduler_groups&#x27;: None, &#x27;password&#x27;: &#x27;&lt;ask&gt;&#x27;, &#x27;request_queue_size&#x27;: 5, &#x27;ssl_certificate&#x27;: &#x27;&#x27;, &#x27;cronjob&#x27;: False, &#x27;numthreads&#x27;: None, &#x27;quiet&#x27;: False, &#x27;import_models&#x27;: False, &#x27;timeout&#x27;: 10, &#x27;plain&#x27;: False, &#x27;nobanner&#x27;: False}&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">db_sessions</td><td style="vertical-align:top;">:</td><td><div>set([])</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">debugging</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">gluon_parent</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_accept</td><td style="vertical-align:top;">:</td><td><div>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_accept_encoding</td><td style="vertical-align:top;">:</td><td><div>gzip, deflate</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_accept_language</td><td style="vertical-align:top;">:</td><td><div>en-us</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_connection</td><td style="vertical-align:top;">:</td><td><div>keep-alive</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_cookie</td><td style="vertical-align:top;">:</td><td><div>session_id_admin=127.0.0.1-2a34b6e8-7adc-42f3-a1be-7dc754917077; session_id_fbmayor=127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_dnt</td><td style="vertical-align:top;">:</td><td><div>1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_host</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1:8088</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_user_agent</td><td style="vertical-align:top;">:</td><td><div>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/537.75.14</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_jython</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_pypy</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_source</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">local_hosts</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>192.168.100.4</div></td></tr><tr><td><div>::ffff:127.0.0.1</div></td></tr><tr><td><div>::1</div></td></tr><tr><td><div>fe80::60c:ceff:fee3:df4a%en0</div></td></tr><tr><td><div>maclogair.local</div></td></tr><tr><td><div>127.0.0.1</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">path_info</td><td style="vertical-align:top;">:</td><td><div>/fbmayor/graphAPI/postCount</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">query_string</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">remote_addr</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">remote_port</td><td style="vertical-align:top;">:</td><td><div>56982</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">request_method</td><td style="vertical-align:top;">:</td><td><div>GET</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">request_uri</td><td style="vertical-align:top;">:</td><td><div>/fbmayor/graphAPI/postCount</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">script_name</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">server_name</td><td style="vertical-align:top;">:</td><td><div>maclogair.local</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">server_port</td><td style="vertical-align:top;">:</td><td><div>8088</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">server_protocol</td><td style="vertical-align:top;">:</td><td><div>HTTP/1.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">server_software</td><td style="vertical-align:top;">:</td><td><div>Rocket 1.2.6</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">web2py_path</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">web2py_version</td><td style="vertical-align:top;">:</td><td><div>2.8.2-stable+timestamp.2013.11.28.13.54.07</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.errors</td><td style="vertical-align:top;">:</td><td><div>&lt;open file &#x27;&lt;stderr&gt;&#x27;, mode &#x27;w&#x27; at 0x10028b1e0&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.file_wrapper</td><td style="vertical-align:top;">:</td><td><div>&lt;class wsgiref.util.FileWrapper at 0x1041be328&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.input</td><td style="vertical-align:top;">:</td><td><div>&lt;socket._fileobject object at 0x11463e850&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.multiprocess</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.multithread</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.run_once</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.url_scheme</td><td style="vertical-align:top;">:</td><td><div>http</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.version</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>1</div></td></tr><tr><td><div>0</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_errors</td><td style="vertical-align:top;">:</td><td><div>&lt;open file &#x27;&lt;stderr&gt;&#x27;, mode &#x27;w&#x27; at 0x10028b1e0&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_file_wrapper</td><td style="vertical-align:top;">:</td><td><div>&lt;class wsgiref.util.FileWrapper at 0x1041be328&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_input</td><td style="vertical-align:top;">:</td><td><div>&lt;socket._fileobject object at 0x11463e850&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_multiprocess</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_multithread</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_run_once</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_url_scheme</td><td style="vertical-align:top;">:</td><td><div>http</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_version</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>1</div></td></tr><tr><td><div>0</div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">extension</td><td style="vertical-align:top;">:</td><td><div>html</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">folder</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources/applications/fbmayor/</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">function</td><td style="vertical-align:top;">:</td><td><div>postCount</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">global_settings</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">app_folders</td><td style="vertical-align:top;">:</td><td><div>set([&#x27;/Applications/web2py.app/Contents/Resources/applications/fbmayor/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/fb_event/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/admin/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/welcome/&#x27;])</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">applications_parent</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cmd_args</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cmd_options</td><td style="vertical-align:top;">:</td><td><div>&lt;Values at 0x104201d40: {&#x27;verbose&#x27;: False, &#x27;ip&#x27;: &#x27;127.0.0.1&#x27;, &#x27;debuglevel&#x27;: 30, &#x27;with_scheduler&#x27;: False, &#x27;ips&#x27;: [&#x27;fe80::60c:ceff:fee3:df4a%en0&#x27;, &#x27;192.168.100.4&#x27;], &#x27;shutdown_timeout&#x27;: 5, &#x27;taskbar&#x27;: False, &#x27;with_coverage&#x27;: False, &#x27;port&#x27;: 8000, &#x27;maxthreads&#x27;: None, &#x27;softcron&#x27;: False, &#x27;server_name&#x27;: &#x27;maclogair.local&#x27;, &#x27;bpython&#x27;: False, &#x27;nogui&#x27;: False, &#x27;pid_filename&#x27;: &#x27;httpserver.pid&#x27;, &#x27;extcron&#x27;: False, &#x27;runcron&#x27;: False, &#x27;run_system_tests&#x27;: False, &#x27;test&#x27;: None, &#x27;folder&#x27;: &#x27;/Applications/web2py.app/Contents/Resources&#x27;, &#x27;config&#x27;: &#x27;&#x27;, &#x27;minthreads&#x27;: None, &#x27;shell&#x27;: None, &#x27;run&#x27;: &#x27;&#x27;, &#x27;log_filename&#x27;: &#x27;httpserver.log&#x27;, &#x27;profiler_dir&#x27;: None, &#x27;args&#x27;: [&#x27;&#x27;], &#x27;socket_timeout&#x27;: 5, &#x27;ssl_ca_certificate&#x27;: None, &#x27;scheduler&#x27;: None, &#x27;interfaces&#x27;: None, &#x27;ssl_private_key&#x27;: &#x27;&#x27;, &#x27;scheduler_groups&#x27;: None, &#x27;password&#x27;: &#x27;&lt;ask&gt;&#x27;, &#x27;request_queue_size&#x27;: 5, &#x27;ssl_certificate&#x27;: &#x27;&#x27;, &#x27;cronjob&#x27;: False, &#x27;numthreads&#x27;: None, &#x27;quiet&#x27;: False, &#x27;import_models&#x27;: False, &#x27;timeout&#x27;: 10, &#x27;plain&#x27;: False, &#x27;nobanner&#x27;: False}&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">db_sessions</td><td style="vertical-align:top;">:</td><td><div>set([])</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">debugging</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">gluon_parent</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_jython</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_pypy</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_source</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">local_hosts</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>192.168.100.4</div></td></tr><tr><td><div>::ffff:127.0.0.1</div></td></tr><tr><td><div>::1</div></td></tr><tr><td><div>fe80::60c:ceff:fee3:df4a%en0</div></td></tr><tr><td><div>maclogair.local</div></td></tr><tr><td><div>127.0.0.1</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">web2py_version</td><td style="vertical-align:top;">:</td><td><div>2.8.2-stable+timestamp.2013.11.28.13.54.07</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_https</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_local</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_restful</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">now</td><td style="vertical-align:top;">:</td><td><div>datetime.datetime(2014, 5, 6, 22, 10, 54, 193922)</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">raw_args</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">raw_extension</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">url</td><td style="vertical-align:top;">:</td><td><div>/fbmayor/graphAPI/postCount</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">utcnow</td><td style="vertical-align:top;">:</td><td><div>datetime.datetime(2014, 5, 6, 14, 10, 54, 193930)</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">uuid</td><td style="vertical-align:top;">:</td><td><div>fbmayor/127.0.0.1.2014-05-06.22-10-54.ddf417c2-8e01-4a4b-9d30-41dc2bb9999b</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi</td><td style="vertical-align:top;">:</td><td><div>&lt;gluon.main.LazyWSGI object at 0x10d7f1690&gt;</div></td></tr></table></div>'
tRp62
sS'frames'
p63
(lp64
(dp65
S'file'
p66
S'/Applications/web2py.app/Contents/Resources/gluon/restricted.py'
p67
sS'dump'
p68
(dp69
S'environment'
p70
S"{'A': <class 'gluon.html.A'>, 'ANY_OF': <class 'gluon.validators.ANY_OF'>, 'Auth': <class 'gluon.tools.Auth'>, 'B': <class 'gluon.html.B'>, 'BEAUTIFY': <class 'gluon.html.BEAUTIFY'>, 'BODY': <class 'gluon.html.BODY'>, 'BR': <class 'gluon.html.BR'>, 'BUTTON': <class 'gluon.html.BUTTON'>, 'CAT': <class 'gluon.html.CAT'>, 'CENTER': <class 'gluon.html.CENTER'>, ...}"
p71
sS'ccode'
p72
S'<code object <module> at 0x1126e0630, file "/App...cations/fbmayor/controllers/graphAPI.py", line 2>'
p73
ssS'lnum'
p74
I217
sS'lines'
p75
(dp76
I212
S'    try:'
p77
sI213
S'        if isinstance(code, types.CodeType):'
p78
sI214
S'            ccode = code'
p79
sI215
S'        else:'
p80
sI216
S'            ccode = compile2(code, layer)'
p81
sI217
S'        exec ccode in environment'
p82
sI218
S'    except HTTP:'
p83
sI219
S'        raise'
p84
sI220
S'    except RestrictedError:'
p85
sI221
S'        # do not encapsulate (obfuscate) the original RestrictedError'
p86
ssS'call'
p87
S"(code='# -*- coding: utf-8 -*-\\nimport ExtendedOpenGraph...sult\\n\\nresponse._vars=response._caller(postCount)\\n', environment={'A': <class 'gluon.html.A'>, 'ANY_OF': <class 'gluon.validators.ANY_OF'>, 'Auth': <class 'gluon.tools.Auth'>, 'B': <class 'gluon.html.B'>, 'BEAUTIFY': <class 'gluon.html.BEAUTIFY'>, 'BODY': <class 'gluon.html.BODY'>, 'BR': <class 'gluon.html.BR'>, 'BUTTON': <class 'gluon.html.BUTTON'>, 'CAT': <class 'gluon.html.CAT'>, 'CENTER': <class 'gluon.html.CENTER'>, ...}, layer='/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py')"
p88
sS'func'
p89
S'restricted'
p90
sa(dp91
g66
S'/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py'
p92
sg68
(dp93
sg74
I1281
sg75
(dp94
I1270
S"            total_post_likes = rows.last()['likes_count'] - rows.first()['likes_count']"
p95
sI1271
S"            total_post_comments = rows.last()['comment_count'] - rows.first()['comment_count']"
p96
sI1272
S"            total_post_shares = rows.last()['shares_count'] - rows.first()['shares_count']"
p97
sI1273
S'    else:'
p98
sI1274
S'        total_post_likes = 0'
p99
sI1275
S'        total_post_comments = 0'
p100
sI1276
S'        total_post_shares = 0'
p101
sI1277
S''
sI1278
S'    result = [total_post_likes,total_post_comments,total_post_shares]'
p102
sI1279
S'    return result'
p103
ssg87
S'()'
p104
sg89
S'<module>'
p105
sa(dp106
g66
S'/Applications/web2py.app/Contents/Resources/gluon/globals.py'
p107
sg68
(dp108
S'self'
p109
S'undefined'
p110
sS'f'
S'<function postCount>'
p111
ssg74
I372
sg75
(dp112
I367
S'        self.menu = []             # used by the default view layout'
p113
sI368
S'        self.files = []            # used by web2py_ajax.html'
p114
sI369
S'        self.generic_patterns = []  # patterns to allow generic views'
p115
sI370
S"        self.delimiters = ('{{', '}}')"
p116
sI371
S'        self._vars = None'
p117
sI372
S'        self._caller = lambda f: f()'
p118
sI373
S'        self._view_environment = None'
p119
sI374
S'        self._custom_commit = None'
p120
sI375
S'        self._custom_rollback = None'
p121
sI376
S''
ssg87
S'(f=<function postCount>)'
p122
sg89
S'<lambda>'
p123
sa(dp124
g66
S'/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py'
p125
sg68
(dp126
S'date2'
p127
S'datetime.timedelta(1)'
p128
sS'global fbpl'
p129
S'<DAL uri="mongodb://localhost/fbmayor">'
p130
sS'Posts'
p131
g110
sS'fbpl.post_counts.fid'
p132
S'<gluon.dal.Field object>'
p133
sS').select'
p134
g110
sS'fbpl.post_counts'
p135
S'<Table post_counts (id,fid,date_time,shares_count,updated_time,likes_count,comment_count)>'
p136
sS'fbpl.post_counts.updated_time'
p137
S'<gluon.dal.Field object>'
p138
sS'fid'
p139
S"'452668974835088'"
p140
sS'date'
p141
S"'2014-04-29 08:00:00'"
p142
ssg74
I67
sg75
(dp143
I64
S'    #date= datetime.datetime.utcnow()'
p144
sI65
S"    #date= datetime.datetime.strptime('2014-04-29 08:00:00','%Y-%m-%d %H:%M:%S')"
p145
sI66
S"    #date2 = datetime.datetime.strptime('2014-04-30 08:00:00','%Y-%m-%d %H:%M:%S')"
p146
sI67
S'    Posts = fbpl( (fbpl.post_counts.fid == fid) & (fbpl.post_counts.updated_time >= date) & (fbpl.post_counts.updated_time < date2)).select()'
p147
sI68
S'    posts_today=len(Posts)'
p148
sI69
S'    return posts_today'
p149
sI70
S''
sI71
S''
sI62
S"    date = '2014-04-29 08:00:00'"
p150
sI63
S'    date2 = + datetime.timedelta(days=1)'
p151
ssg87
S'()'
p152
sg89
S'postCount'
p153
sa(dp154
g66
S'/Applications/web2py.app/Contents/Resources/gluon/dal.py'
p155
sg68
(dp156
S'self.query'
p157
S"<Query {'$and': [{'$and': [{'fid': '452668974835...updated_time': {'$lt': datetime.timedelta(1)}}]}>"
p158
sS'adapter.select'
p159
S'<bound method MongoDBAdapter.select of <gluon.dal.MongoDBAdapter object>>'
p160
sS'fields'
p161
S'[<gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>]'
p162
sS'adapter'
p163
S'<gluon.dal.MongoDBAdapter object>'
p164
sS'attributes'
p165
g21
sS'self'
p166
S"<Set {'$and': [{'$and': [{'fid': '45266897483508...updated_time': {'$lt': datetime.timedelta(1)}}]}>"
p167
ssg74
I10335
sg75
(dp168
I10336
S''
sI10337
S'    def nested_select(self,*fields,**attributes):'
p169
sI10338
S'        return Expression(self.db,self._select(*fields,**attributes))'
p170
sI10339
S''
sI10330
S"                                    attributes.get('join',None),"
p171
sI10331
S"                                    attributes.get('left',None),"
p172
sI10332
S"                                    attributes.get('orderby',None),"
p173
sI10333
S"                                    attributes.get('groupby',None))"
p174
sI10334
S'        fields = adapter.expand_all(fields, tablenames)'
p175
sI10335
S'        return adapter.select(self.query,fields,attributes)'
p176
ssg87
S"(self=<Set {'$and': [{'$and': [{'fid': '45266897483508...updated_time': {'$lt': datetime.timedelta(1)}}]}>, *fields=[<gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>], **attributes={})"
p177
sg89
S'select'
p178
sa(dp179
g66
S'/Applications/web2py.app/Contents/Resources/gluon/dal.py'
p180
sg68
(dp181
S'record'
p182
g110
sS'mongo_list_dicts'
p183
S'<pymongo.cursor.Cursor object>'
p184
ssg74
I5784
sg75
(dp185
I5779
S'            if fieldname == "_id":'
p186
sI5780
S'                # Mongodb reserved uuid key'
p187
sI5781
S'                field.name = "id"'
p188
sI5782
S'            newnames.append(".".join((tablename, field.name)))'
p189
sI5783
S''
sI5784
S'        for record in mongo_list_dicts:'
p190
sI5785
S'            row=[]'
p191
sI5786
S'            for colname in colnames:'
p192
sI5787
S'                tablename, fieldname = colname.split(".")'
p193
sI5788
S'                # switch to Mongo _id uuids for retrieving'
p194
ssg87
S"(self=<gluon.dal.MongoDBAdapter object>, query=<Query {'$and': [{'$and': [{'fid': '452668974835...updated_time': {'$lt': datetime.timedelta(1)}}]}>, fields=[<gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>, <gluon.dal.Field object>], attributes={}, count=False, snapshot=False)"
p195
sg89
g178
sa(dp196
g66
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pymongo-2.6.3-py2.7-macosx-10.8-intel.egg/pymongo/cursor.py'
p197
sg68
(dp198
S'builtinlen'
p199
S'<built-in function len>'
p200
sS'self'
p201
S'<pymongo.cursor.Cursor object>'
p202
sS'self.__data'
p203
g110
sS'self._refresh'
p204
S'<bound method Cursor._refresh of <pymongo.cursor.Cursor object>>'
p205
ssg74
I904
sg75
(dp206
I899
S''
sI900
S'    def next(self):'
p207
sI901
S'        if self.__empty:'
p208
sI902
S'            raise StopIteration'
p209
sI903
S'        db = self.__collection.database'
p210
sI904
S'        if len(self.__data) or self._refresh():'
p211
sI905
S'            if self.__manipulate:'
p212
sI906
S'                return db._fix_outgoing(self.__data.popleft(),'
p213
sI907
S'                                        self.__collection)'
p214
sI908
S'            else:'
p215
ssg87
S'(self=<pymongo.cursor.Cursor object>)'
p216
sg89
S'next'
p217
sa(dp218
g66
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pymongo-2.6.3-py2.7-macosx-10.8-intel.egg/pymongo/cursor.py'
p219
sg68
(dp220
S'self'
p221
S'<pymongo.cursor.Cursor object>'
p222
sS'self.__uuid_subtype'
p223
g110
ssg74
I848
sg75
(dp224
I843
S'            self.__send_message('
p225
sI844
S'                message.query(self.__query_options(),'
p226
sI845
S'                              self.__collection.full_name,'
p227
sI846
S'                              self.__skip, ntoreturn,'
p228
sI847
S'                              self.__query_spec(), self.__fields,'
p229
sI848
S'                              self.__uuid_subtype))'
p230
sI849
S'            if not self.__id:'
p231
sI850
S'                self.__killed = True'
p232
sI851
S'        elif self.__id:  # Get More'
p233
sI852
S'            if self.__limit:'
p234
ssg87
S'(self=<pymongo.cursor.Cursor object>)'
p235
sg89
S'_refresh'
p236
sasS'pyver'
p237
S'Python 2.7.5: /Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python (prefix: /Library/Frameworks/Python.framework/Versions/2.7)'
p238
sS'session'
p239
g61
(S's\xb0\x0c\x00\x00<div><table><tr><td style="font-weight:bold;vertical-align:top;">auth</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">expiration</td><td style="vertical-align:top;">:</td><td><div>3600</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">hmac_key</td><td style="vertical-align:top;">:</td><td><div>af6e21b3-8f56-4a0f-8e40-9f0e85f0004e</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">last_visit</td><td style="vertical-align:top;">:</td><td><div>datetime.datetime(2014, 5, 6, 22, 10, 54, 193922)</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">remember</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">user</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">first_name</td><td style="vertical-align:top;">:</td><td><div>Chih-Yuan</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">id</td><td style="vertical-align:top;">:</td><td><div>1L</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">last_name</td><td style="vertical-align:top;">:</td><td><div>Chen</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">registration_id</td><td style="vertical-align:top;">:</td><td><div>614901526</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">registration_key</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">username</td><td style="vertical-align:top;">:</td><td><div>614901526</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">user_groups</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">1</td><td style="vertical-align:top;">:</td><td><div>user_1</div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">flash</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">last_orderby</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">last_query</td><td style="vertical-align:top;">:</td><td><div>fbpl.post_counts.fid==&#x27;452668974835088&#x27;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">redirect_uri</td><td style="vertical-align:top;">:</td><td><div>http://127.0.0.1:8088/fbmayor/default/user/login</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">token</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">access_token</td><td style="vertical-align:top;">:</td><td><div>CAADSl0gHeTUBAEuFvC6ZAGOZBoIoO0LuJ2UflY5I73R4EzaZAaZAoPFZBqZB2WAdEe2YzfJn2VRWogX3Eq3OXh5RLvbcDZAnC3HFkxlE0c7DFBOULWcAYSSdY09jXZCl7GZAfSYF89HbiCu9w1PZBgfptmLj9rpOOe2CFBUd9HmvSezf4rpsi3U3YI</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">expires</td><td style="vertical-align:top;">:</td><td><div>1404544508.806448</div></td></tr></table></div></td></tr></table></div>'
tRp240
sS'etype'
p241
S"<class 'bson.errors.InvalidDocument'>"
p242
sS'date'
p243
S'Tue May  6 22:10:54 2014'
p244
sS'response'
p245
g61
(S's+&\x00\x00<div><table><tr><td style="font-weight:bold;vertical-align:top;">body</td><td style="vertical-align:top;">:</td><td><div>&lt;cStringIO.StringO object at 0x1148699d0&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cookies</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">session_id_fbmayor</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93<table><tr><td style="font-weight:bold;vertical-align:top;">comment</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">domain</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">expires</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">httponly</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">max-age</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">path</td><td style="vertical-align:top;">:</td><td><div>/</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">secure</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">version</td><td style="vertical-align:top;">:</td><td><div></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">delimiters</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>{{</div></td></tr><tr><td><div>}}</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">files</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">flash</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">generic_patterns</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">google_analytics_id</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">headers</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">X-Powered-By</td><td style="vertical-align:top;">:</td><td><div>web2py</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">logo</td><td style="vertical-align:top;">:</td><td><div><a class="brand" data-w2p_disable_with="default" href="http://www.web2py.com/"><b>web<span>2</span>py</b>&trade;&nbsp;</a></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">menu</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div><table><tr><td><div>POI</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_form</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Add POI</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addplace</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>People</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_people</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Add People</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addpeople</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Page</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_page</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Page Count</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/index</div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Add Page</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addpage</div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Update Pages</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/graphAPI/countAllPageSocialCount</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Post</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_post</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Add Post</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addpost</div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Get Post</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/graphAPI/collect_posts</div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Update Posts</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/graphAPI/countAllPostSocialCount</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Event</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_event</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Add Event</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addevent</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">meta</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">author</td><td style="vertical-align:top;">:</td><td><div>Your Name &lt;you@example.com&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">description</td><td style="vertical-align:top;">:</td><td><div>a cool new app</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">generator</td><td style="vertical-align:top;">:</td><td><div>Web2py Web Framework</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">keywords</td><td style="vertical-align:top;">:</td><td><div>web2py, python, framework</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">models_to_run</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>^\\w+\\.py$</div></td></tr><tr><td><div>^graphAPI/\\w+\\.py$</div></td></tr><tr><td><div>^graphAPI/postCount/\\w+\\.py$</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">postprocessing</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_client</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_cookie_compression_level</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_cookie_expires</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_cookie_key</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_data_name</td><td style="vertical-align:top;">:</td><td><div>session_data_fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_file</td><td style="vertical-align:top;">:</td><td><div>&lt;open file &#x27;/Applications/web2py.app/Contents/Resources/applications/fbmayor/sessions/127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93&#x27;, mode &#x27;rb+&#x27; at 0x1044cf8a0&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_filename</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources/applications/fbmayor/sessions/127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_hash</td><td style="vertical-align:top;">:</td><td><div>08e82bc6db87b1a459c03bcf05f9b8a8</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_id</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_id_name</td><td style="vertical-align:top;">:</td><td><div>session_id_fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_locked</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_masterapp</td><td style="vertical-align:top;">:</td><td><div>fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_new</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_storage_type</td><td style="vertical-align:top;">:</td><td><div>file</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">status</td><td style="vertical-align:top;">:</td><td><div>200</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">subtitle</td><td style="vertical-align:top;">:</td><td><div>customize me!</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">title</td><td style="vertical-align:top;">:</td><td><div>Fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">view</td><td style="vertical-align:top;">:</td><td><div>graphAPI/postCount.html</div></td></tr></table></div>'
tRp246
sS'locals'
p247
(dp248
S'self'
p249
S'<pymongo.cursor.Cursor object>'
p250
sS'ntoreturn'
p251
S'0'
sssS'traceback'
p252
S'Traceback (most recent call last):\n  File "/Applications/web2py.app/Contents/Resources/gluon/restricted.py", line 217, in restricted\n    exec ccode in environment\n  File "/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py", line 1281, in <module>\n  File "/Applications/web2py.app/Contents/Resources/gluon/globals.py", line 372, in <lambda>\n    self._caller = lambda f: f()\n  File "/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py", line 67, in postCount\n    Posts = fbpl( (fbpl.post_counts.fid == fid) & (fbpl.post_counts.updated_time >= date) & (fbpl.post_counts.updated_time < date2)).select()\n  File "/Applications/web2py.app/Contents/Resources/gluon/dal.py", line 10335, in select\n    return adapter.select(self.query,fields,attributes)\n  File "/Applications/web2py.app/Contents/Resources/gluon/dal.py", line 5784, in select\n    for record in mongo_list_dicts:\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pymongo-2.6.3-py2.7-macosx-10.8-intel.egg/pymongo/cursor.py", line 904, in next\n    if len(self.__data) or self._refresh():\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pymongo-2.6.3-py2.7-macosx-10.8-intel.egg/pymongo/cursor.py", line 848, in _refresh\n    self.__uuid_subtype))\nInvalidDocument: Cannot encode object: datetime.timedelta(1)\n'
p253
s.