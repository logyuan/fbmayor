(dp1
S'output'
p2
S"<class 'urllib2.URLError'> <urlopen error [Errno 65] No route to host>"
p3
sS'layer'
p4
S'/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\nimport ExtendedOpenGraph\nfrom facebook import GraphAPI, GraphAPIError\nimport json\nfrom collections import OrderedDict\nimport datetime\nfrom dateutil import parser\n\n@auth.requires_login()\ndef test2():\n    import time\n    graph = getGraph()\n    #rows = fbpl().select(fbpl.post.ALL)\n    gid = \'652438848137404\'\n    fb_obj = graph.request(gid, args={\'fields\': \'insights\'})\n    insights=[]\n    insights = fb_obj["insights"]["data"] if  (\'insights\' in fb_obj) else []\n    lifetime_likes = sum(insights[0]["values"][2]["value"].values())\n    daily_people_talking = sum(insights[1]["values"][2]["value"].values())\n    weekly_people_talking = sum(insights[2]["values"][2]["value"].values())\n    monthly_people_talking = sum(insights[3]["values"][2]["value"].values())\n    return str(lifetime_likes) + \' \' + str(daily_people_talking) + \' \' + str(weekly_people_talking)+ \' \' +str(monthly_people_talking)\n\ndef test():\n    date = datetime.datetime.strptime("2014-04-25 00:00:00", \'%Y-%m-%d %H:%M:%S\')            \n    date2 = date + datetime.timedelta(hours=24)\n    date3 = date2 + datetime.timedelta(hours=24)\n    likes1 = fbpl((fbpl.post_counts.date_time >= date)).select().first()\n    likes2 = fbpl((fbpl.post_counts.date_time >= date2) ).select().first()\n    Posts = fbpl((fbpl.post.team == \'\xe6\x9f\xaf\xe6\x96\x87\xe5\x93\xb2\') & (fbpl.post.status_type <> \'\') & (fbpl.post.created_time >= date) & (fbpl.post.created_time < date2) ).select()\n    dailyPosts =len(Posts)\n    return dict(likes1=likes1,likes2=likes2,dailyPosts=dailyPosts)\n\ndef fixtime():\n    #hour48 = (now - datetime.timedelta(days=2)).strftime(\'%Y-%m-%d %H:%M:%S\')\n    #hour48 = datetime.datetime.strptime(hour48,\'%Y-%m-%d %H:%M:%S\')\n    rows = fbpl(fbpl.post.id>0).select()\n    for row in rows:\n        created_time = str(row.created_time)\n        #created_time2 = created_time\n        #updated_time= row.updated_time.strftime(\'%Y-%m-%d %H:%M:%S\')\n        created_time = datetime.datetime.strptime(created_time,\'%Y-%m-%d %H:%M:%S\')\n        #updated_time = datetime.datetime.strptime(updated_time,\'%Y-%m-%d %H:%M:%S\')\n\n        row.update_record(created_time=created_time)\n    return "success"\n\ndef fixtime2():\n\n    rows = fbpl(fbpl.post_counts.id>0).select()\n    for row in rows:\n        date_time = row.date_time.strftime(\'%Y-%m-%d %H:%M:%S\')\n        date_time = datetime.datetime.strptime(date_time,\'%Y-%m-%d %H:%M:%S\' )\n        #updated_time= (date_time - datetime.timedelta(hours=7)).strftime(\'%Y-%m-%d %H:%M:%S\')\n        #updated_time = datetime.datetime.strptime(updated_time,\'%Y-%m-%d %H:%M:%S\' )\n        \n        row.update_record(date_time=date_time)\n    return "success"\n\ndef postCount():\n    #date= datetime.datetime.utcnow()\n    date= datetime.datetime.strptime(\'2014-04-29 08:00:00\',\'%Y-%m-%d %H:%M:%S\')\n    date2 = datetime.datetime.strptime(\'2014-04-30 08:00:00\',\'%Y-%m-%d %H:%M:%S\')\n    Posts = fbpl( (fbpl.post_counts.fid == \'10201495734424798\') & (fbpl.post_counts.updated_time >= date) & (fbpl.post_counts.updated_time < date2)).select()\n    posts_today=len(Posts)\n    return posts_today\n\n\n#1.\xe9\x80\x99\xe9\x83\xa8\xe4\xbb\xbd\xe6\x8e\x92\xe7\xa8\x8b\xe6\x8a\x8a\xe6\x89\x80\xe6\x9c\x89\xe7\x9a\x84\xe5\xb0\x88\xe9\xa0\x81\xe7\x9a\x84likes \xe9\x82\x84\xe6\x9c\x89 talkingabout\xe6\x9b\xb4\xe6\x96\xb0\xe3\x80\x82\n@auth.requires_login()\ndef countAllPageSocialCount():\n    import datetime\n    import time\n\n    graph = getGraph()\n    rows = fbpl().select(fbpl.page.pageid, orderby=fbpl.page.id)\n    start_date_time=datetime.datetime.today().strftime(\'%Y-%m-%d %H:%M:%S\')\n    start_date_time=datetime.datetime.strptime(start_date_time, \'%Y-%m-%d %H:%M:%S\')\n    for row in rows:\n        gid= row.pageid\n        #check if the Facebook has the graphic\n        getPageSocialCount(gid)\n\n    message = teamCount()\n    end_date_time=datetime.datetime.today().strftime(\'%Y-%m-%d %H:%M:%S\')\n    end_date_time=datetime.datetime.strptime(end_date_time, \'%Y-%m-%d %H:%M:%S\')\n    fbpl.update_log.insert(start_date_time=start_date_time,end_date_time=end_date_time)\n    message = \'Successfully update socialcount of pages\'\n    return dict(message=message)\n\n#2.get likes , checkins, were_here_count, talking_about_count, \n@auth.requires_login()\ndef getPageSocialCount(gid):\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        if gid:\n            oid = gid\n        else:\n            message=\'failure, please check your placeid!\'\n            return dict(message=message)\n        pid = checkGraphId(oid)\n        if pid <> \'0\':\n            if pid <> oid :\n                record2 = fbpl(fbpl.page.pageid==pid).select().first()\n                if not (record2) :\n                   getPage(pid)\n                   time.sleep(1)\n                   fbpl(fbpl.page.pageid==oid).delete()\n            fb_obj = graph.request(pid ,args={\'fields\': \'id,name, category, about, can_post, checkins, talking_about_count, were_here_count, link,description, cover, website, picture.type(large), is_published,likes.limit(1).summary(true), insights\'})\n            checkins =  fb_obj["checkins"] if  (\'checkins\' in fb_obj) else 0\n            likes= fb_obj["likes"] if  (\'likes\' in fb_obj) else 0\n            were_here_count= fb_obj["were_here_count"] if  (\'were_here_count\' in fb_obj) else 0\n            talking_about_count\t = fb_obj["talking_about_count"] if  (\'talking_about_count\' in fb_obj) else 0\n            updated_time = datetime.datetime.utcnow().strftime(\'%Y-%m-%dT%H:%M:%S+0000\')\n            updated_time = datetime.datetime.strptime(updated_time,\'%Y-%m-%dT%H:%M:%S+0000\')\n            date_time = datetime.datetime.today().strftime(\'%Y-%m-%d %H:%M:%S\')\n            date_time = datetime.datetime.strptime(date_time,\'%Y-%m-%d %H:%M:%S\')\n            row = fbpl.page(pageid=pid)\n            checkins24= 0\n            likes24 = 0\n            were_here_count24 = 0\n            talking_about_count24 = 0\n            if row:\n                fbpl.social_counts.insert(placeid=pid,checkins = checkins,likes=likes,date_time=date_time,were_here_count=were_here_count,updated_time=updated_time,talking_about_count=talking_about_count)\n                fbpl.commit()\n                likes_sincelastupdate = int(likes)-int(row.likes) if likes else 0\n                checkins_sincelastupdate = int(checkins)-int(row.checkins) if checkins else 0\n                talking_about_sincelastupdate = int(talking_about_count)-int(row.talking_about_count) if talking_about_count else 0\n                were_here_sincelastupdate = int(were_here_count)-int(row.were_here_count) if were_here_count else 0\n                plist = getPageCount(gid, 0 , 1)\n                checkins24= plist[0]\n                likes24 = plist[1]\n                were_here_count24= plist[2]\n                talking_about_count24= plist[3]\n                #now = datetime.datetime.now()\n                #hour24 = hourdiff(now,24)\n                #row2 = fbpl((fbpl.social_counts.date_time <= hour24) & (fbpl.social_counts.placeid==pid) ).select(fbpl.social_counts.ALL).last()\n                #if row2:\n                #    likes_sincelastupdate = int(likes)-int(row2.likes) if likes else 0\n                #    checkins_sincelastupdate = int(checkins)-int(row2.checkins) if checkins else 0\n                #    talking_about_sincelastupdate = int(talking_about_count)-int(row2.talking_about_count) if talking_about_count else 0\n                #    were_here_sincelastupdate = int(were_here_count)-int(row2.were_here_count) if were_here_count else 0\n                #else:  #if no record can be found in the social_counts then use the last time number\n                #    likes_sincelastupdate = int(likes)-int(row.likes) if likes else 0\n                #    checkins_sincelastupdate = int(checkins)-int(row.checkins) if checkins else 0\n                #    talking_about_sincelastupdate = int(talking_about_count)-int(row.talking_about_count) if talking_about_count else 0\n                #    were_here_sincelastupdate = int(were_here_count)-int(row.were_here_count) if were_here_count else 0\n                row.update_record(checkins = checkins, likes=likes, date_time=date_time, were_here_count=were_here_count, updated_time=updated_time, talking_about_count=talking_about_count, likes_sincelastupdate=likes_sincelastupdate, talking_about_sincelastupdate=talking_about_sincelastupdate, checkins_sincelastupdate=checkins_sincelastupdate, were_here_sincelastupdate=were_here_sincelastupdate , checkins24=checkins24, likes24=likes24, were_here_count24=were_here_count24, talking_about_count24=talking_about_count24 )\n            else:\n                likes_sincelastupdate =  0\n                checkins_sincelastupdate =  0\n                talking_about_sincelastupdate = 0\n                were_here_sincelastupdate = 0\n                fbpl.page.insert(pageid=pid, checkins = checkins, likes=likes, date_time=date_time, were_here_count=were_here_count, updated_time=updated_time, talking_about_count=talking_about_count, likes_sincelastupdate=likes_sincelastupdate, talking_about_sincelastupdate=talking_about_sincelastupdate, checkins_sincelastupdate=checkins_sincelastupdate, were_here_sincelastupdate=were_here_sincelastupdate)\n                fbpl.commit()\n                fbpl.social_counts.insert(placeid=pid,checkins = checkins,likes=likes,date_time=date_time,were_here_count=were_here_count,updated_time=updated_time,talking_about_count=talking_about_count)\n                fbpl.commit()\n            time.sleep(1.1)\n            message=\'Successfully update the PageSocialCount\'\n            return dict(message=message)\n        else:\n            return dict(message=\'failure, please check your placeid!\')\n\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n\n\n    #response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=message)  #dict(message=str[9])\n\n#3.\xe6\xaa\xa2\xe6\x9f\xa5\xe5\x90\x84\xe5\x80\x8b\xe5\xb0\x88\xe9\xa0\x81\xe6\x98\xaf\xe5\x90\xa6\xe6\x9c\x89\xe6\x96\xb0\xe6\x96\x87\xe7\xab\xa0\n@auth.requires_login()\ndef collect_posts():\n    import time\n    rows = fbpl().select(fbpl.page.pageid)\n    for row in rows:\n        getPagePosts(row.pageid)\n        time.sleep(1)\n    return "All page posts Finished"\n\n#4.\n@auth.requires_login()\ndef getPagePosts(pageid):\n    import time\n    try:\n        graph = getGraph()\n        posts_data=graph.request(pageid + \'/posts\', args={\'fields\':\'id, place, message, updated_time, from, created_time, status_type, type, link, picture, likes.limit(1).summary(true), shares, comments.limit(1).summary(true), object_id\'})\n        data = []\n        data = posts_data["data"]\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pageid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n    try:\n        for post in data:\n            fid = post["id"].split(\'_\')[1]\n            row = fbpl.post(fid=fid)\n            if row:\n                pass\n                #message =  post["message"] if (\'message\' in post) else \'\'\n                #updated_time = datetime.datetime.strptime(post["updated_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'updated_time\' in post) else \'\'\n                #likes_count = post["likes"]["summary"]["total_count"] if (\'likes\' in post) else 0\n                #comment_count = post["comments"]["summary"]["total_count"] if (\'comments\' in post) else 0\n                #shares_count = post["shares"][\'count\'] if (\'shares\' in post) else 0\n                #now = datetime.datetime.utcnow()\n                #hour48 = hourdiff(now,48)\n                #row2 = fbpl((fbpl.post_counts.date_time <= hour48) & (fbpl.post_counts.fid==fid) ).select(fbpl.post_counts.ALL).last()\n                #if row2:\n                #    likes_sincelastupdate = int(likes_count)-int(row2.likes_count) if likes_count else 0\n                #    shares_sincelastupdate = int(shares_count)-int(row2.shares_count) if shares_count else 0\n                #    comment_sincelastupdate = int(comment_count)-int(row2.comment_count) if comment_count else 0\n                #else:  #if no record can be found in the post_counts then use the last time number\n                #    likes_sincelastupdate = int(likes_count)-int(row.likes_count) if likes_count else 0\n                #    shares_sincelastupdate = int(shares_count)-int(row.shares_count) if shares_count else 0\n                #    comment_sincelastupdate = int(comment_count)-int(row.comment_count) if comment_count else 0\n                #likes_sincelastupdate = int(likes_count)-int(row.likes_count) if likes_count else 0\n                #shares_sincelastupdate = int(shares_count)-int(row.shares_count) if shares_count else 0\n                #comment_sincelastupdate = int(comment_count)-int(row.comment_count) if comment_count else 0                \n\n                #link= row["link"]\n                #object_id = row["object_id"]\n                #------------ after update it can be deleted\n                #ptype = row.ptype\n                #if (ptype == \'link\' ) | (ptype == \'video\'):\n                #    try:\n                #        picture =getOpengraphImage(link)\n                #        if picture == \'\':\n                #            picture = post["picture"] if (\'picture\' in post) else \'\'\n                #    except:\n                #        picture = post["picture"] if (\'picture\' in post) else \'\'\n                #elif (ptype == \'photo\' ) :\n                #    try:\n                #        images=[]\n                #        images =graph.request(object_id , args={\'fields\':\'images\'})["images"]\n                #        for image in images:\n                #            if (image["height"] > 200) & (image["width"] > 150):\n                #                picture = image["source"]\n                        #time.sleep(1)\n                #    except:\n                #       picture = post["picture"] if (\'picture\' in post) else \'\'\n                #else:\n                #    picture = post["picture"] if (\'picture\' in post) else \'\'\n\n                #row.update_record(message=message, shares_count=shares_count, likes_count=likes_count, comment_count=comment_count, likes_sincelastupdate=likes_sincelastupdate, shares_sincelastupdate=shares_sincelastupdate, comment_sincelastupdate=comment_sincelastupdate, updated_time=updated_time,picture=picture)\n            else:\n                message =  post["message"] if (\'message\' in post) else \'\'\n                from_id = post["from"]["id"] if (\'from\' in post) else \'\'\n                from_name = post["from"]["name"] if (\'from\' in post) else \'\'\n                created_time = datetime.datetime.strptime(post["created_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'created_time\' in post) else \'\'\n                updated_time = datetime.datetime.strptime(post["updated_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'updated_time\' in post) else \'\'\n                status_type = post["status_type"] if (\'status_type\' in post) else \'\'\n                ptype = post["type"] if (\'type\' in post) else \'\'\n                status_type = post["status_type"] if (\'status_type\' in post) else \'\'\n                link = post["link"] if (\'link\' in post) else \'\'\n                shares_count = post["shares"][\'count\'] if (\'shares\' in post) else 0\n                likes_count = post["likes"]["summary"]["total_count"] if (\'likes\' in post) else 0\n                comment_count = post["comments"]["summary"]["total_count"] if (\'comments\' in post) else 0\n                object_id = post["object_id"] if (\'object_id\' in post) else \'\'\n                placeid = post["place"]["id"] if (\'place\' in post) else \'\'\n                placename = post["place"]["name"] if (\'place\' in post) else \'\'\n                tscore = shares_count*0.5 + comment_count*0.3 + likes_count*0.2\n                if placeid != \'\' :\n                    getPlace(placeid)\n                    time.sleep(1)\n                row=fbpl(fbpl.page.pageid==from_id).select().first()\n                team = row[\'team\']\n                likes_sincelastupdate=0\n                shares_sincelastupdate=0\n                comment_sincelastupdate=0\n                if (ptype == \'link\' ) | (ptype == \'video\'):\n                    try:\n                        picture =getOpengraphImage(link)\n                        if picture == \'\':\n                            picture = post["picture"] if (\'picture\' in post) else \'\'\n                    except:\n                        picture = post["picture"] if (\'picture\' in post) else \'\'\n                elif (ptype == \'photo\' ) :\n                    try:\n                        images=[]\n                        images =graph.request(object_id , args={\'fields\':\'images\'})["images"]\n                        for image in images:\n                            if (image["height"] > 200) & (image["width"] > 150):\n                                picture = image["source"]\n                        #time.sleep(1)\n                    except:\n                        picture = post["picture"] if (\'picture\' in post) else \'\'\n                else:\n                    picture = post["picture"] if (\'picture\' in post) else \'\'\n                \n                fbpl.post.insert(fid=fid, message=message,from_id=from_id, from_name=from_name, created_time=created_time,object_id=object_id,ptype=ptype,status_type=status_type, link=link, picture=picture ,shares_count=shares_count, likes_count=likes_count, comment_count=comment_count, likes_sincelastupdate=likes_sincelastupdate, shares_sincelastupdate=shares_sincelastupdate, comment_sincelastupdate=comment_sincelastupdate, team=team, placeid=placeid, placename=placename, updated_time=updated_time, tscore=tscore)\n                fbpl.commit()\n\n        message = "all posts finished"\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=fid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n#5.\n@auth.requires_login()\ndef getPostSocialCount(from_id,fid):\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        if fid:\n            fb_obj = graph.request(from_id + \'_\' + fid ,args={\'fields\': \'id, shares, updated_time,comments.limit(1).summary(true), message, likes.limit(1).summary(true)\'})\n\n            shares_count = int(fb_obj["shares"]["count"]) if (\'shares\' in fb_obj) else 0\n            updated_time = datetime.datetime.strptime(fb_obj["updated_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'updated_time\' in fb_obj) else \'\'\n            likes_count = int(fb_obj["likes"]["summary"]["total_count"]) if (\'likes\' in fb_obj) else 0\n            comment_count = int(fb_obj["comments"]["summary"]["total_count"]) if (\'comments\' in fb_obj) else 0\n            date_time = datetime.datetime.today()\n            row = fbpl(fbpl.post.fid==str(fid)).select().first()\n            if row :\n                fbpl.post_counts.insert(fid=fid, updated_time=updated_time, shares_count=shares_count, date_time=date_time, likes_count=likes_count, comment_count=comment_count)\n                fbpl.commit()\n                #post used s local_time, it is better in the future all the Fields use the UTC time format\n            #    now = datetime.datetime.now()\n            #    hour48 = hourdiff(now,48)\n            #    row2 = fbpl((fbpl.post_counts.date_time >= hour48) & (fbpl.post_counts.fid==fid) ).select(fbpl.post_counts.ALL).first()\n            #    if row2:\n            #        likes_sincelastupdate = int(likes_count)-int(row2.likes_count) if likes_count else 0\n            #        shares_sincelastupdate = int(shares_count)-int(row2.shares_count) if shares_count else 0\n            #        comment_sincelastupdate = int(comment_count)-int(row2.comment_count) if comment_count else 0\n            #    else:  #if no record can be found in the post_counts then use the last time number\n            #        likes_sincelastupdate = int(likes_count)-int(row.likes_count) if likes_count else 0\n            #        shares_sincelastupdate = int(shares_count)-int(row.shares_count) if shares_count else 0\n            #        comment_sincelastupdate = int(comment_count)-int(row.comment_count) if comment_count else 0\n            #\n                likes_sincelastupdate = int(likes_count)-int(row.likes_count) if likes_count else 0\n                shares_sincelastupdate = int(shares_count)-int(row.shares_count) if shares_count else 0\n                comment_sincelastupdate = int(comment_count)-int(row.comment_count) if comment_count else 0\n                list1 = getPostCount(fid, 0, 2)\n                likes_count48= list1[0]\n                comment_count48= list1[1]\n                shares_count48= list1[2]\n                fscore = shares_count48*0.5 + comment_count48*0.3 + likes_count48*0.2\n                tscore = shares_count*0.5 + comment_count*0.3 + likes_count*0.2\n                row.update_record(updated_time=updated_time, shares_count=shares_count, likes_count=likes_count, comment_count=comment_count,likes_sincelastupdate=likes_sincelastupdate,shares_sincelastupdate=shares_sincelastupdate,comment_sincelastupdate=comment_sincelastupdate, fscore=fscore, likes_count48=likes_count48, comment_count48=comment_count48, shares_count48=shares_count48, tscore=tscore)\n\n\n            time.sleep(1)\n            message=\'Successfully update the PostSocialCount\'\n            return dict(message=message)\n        else:\n            return dict(message=\'failure, please check your placeid!\')\n\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=fid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n\n    #response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=message)  #dict(message=str[9])\n\n\n\n#6\n\n@auth.requires_login()\ndef countAllPostSocialCount():\n    import datetime\n    import time\n    now = datetime.datetime.utcnow()\n    #Only do the update when the tscore > 0 or the post is updated in the last two weeks\n    week2 = (now - datetime.timedelta(hours=24*14)).strftime(\'%Y-%m-%d %H:%M:%S+0000\')\n    rows = fbpl(( fbpl.post.tscore <> 0) | (fbpl.post.updated_time > week2 ) ).select(fbpl.post.fid,fbpl.post.from_id, orderby=fbpl.post.id)\n    start_date_time=datetime.datetime.today()\n\n    for row in rows:\n        gid= row.fid\n        from_id = row.from_id\n        #check if the Facebook has the graphic\n        getPostSocialCount(from_id,gid)\n\n\n    end_date_time=datetime.datetime.today()\n    fbpl.update_log.insert(start_date_time=start_date_time,end_date_time=end_date_time)\n    message = \'Successfully update socialcount of posts\'\n    return dict(message=message)\n\n#7\ndef teamCount():\n    errorMsg="success made the teamCount"\n    candidates = []\n    candidates.append("\xe9\x80\xa3\xe5\x8b\x9d\xe6\x96\x87")\n    candidates.append("\xe6\x9f\xaf\xe6\x96\x87\xe5\x93\xb2")\n    candidates.append("\xe9\xa1\xa7\xe7\xab\x8b\xe9\x9b\x84")\n    \n    results=OrderedDict()\n    try:\n        for candidate in candidates:\n\n            total_active_posts = 0\n            total_post_likes = 0\n            total_post_comments = 0\n            total_post_shares = 0\n            rows = fbpl( (fbpl.post.team == candidate ) & (fbpl.post.tscore > 0 )).select()\n            for row in rows:\n                total_post_likes += row.likes_count\n                total_post_comments += row.comment_count\n                total_post_shares += row.shares_count\n\n            total_active_posts = len(rows)\n#---------------------------------------------------------------------------------------------#\n            hour48_active_posts =0\n            hour48_post_likes = 0\n            hour48_post_comments = 0\n            hour48_post_shares = 0\n\n            rows = fbpl( ((fbpl.post.team == candidate) & ( fbpl.post.fscore > 0))  ).select()\n\n            for row in rows:\n                hour48_post_likes += row.likes_count48\n                hour48_post_comments += row.comment_count48\n                hour48_post_shares += row.shares_count48\n\n            hour48_active_posts = len(rows)\n\n#---------------------------------------------------------------------------------------------#\n            hour48_active_stories =0\n            hour48_story_likes = 0\n            hour48_story_comments = 0\n            hour48_story_shares = 0\n\n            rows = fbpl( ((fbpl.post.team == candidate) & ( fbpl.post.fscore > 0)) & ((fbpl.post.ptype == \'photo\') | ( fbpl.post.ptype == \'status\'))  ).select()\n            for row in rows:\n                hour48_story_likes += row.likes_count48\n                hour48_story_comments += row.comment_count48\n                hour48_story_shares += row.shares_count48\n\n            hour48_active_stories = len(rows)\n\n\n#---------------------------------------------------------------------------------------------#\n            hour48_active_links =0\n            hour48_link_likes = 0\n            hour48_link_comments = 0\n            hour48_link_shares = 0\n\n            rows = fbpl( ((fbpl.post.team == candidate) & ( fbpl.post.fscore > 0) &( fbpl.post.ptype == \'link\') ) ).select() #| ((fbpl.post.team == candidate) & (fbpl.post.created_time >= week ))\n            for row in rows:\n                hour48_link_likes += row.likes_count48\n                hour48_link_comments += row.comment_count48\n                hour48_link_shares += row.shares_count48\n\n            hour48_active_links = len(rows)\n\n#---------------------------------------------------------------------------------------------#\n            hour48_active_videos =0\n            hour48_video_likes = 0\n            hour48_video_comments = 0\n            hour48_video_shares = 0\n\n            rows = fbpl( ((fbpl.post.team == candidate) & ( fbpl.post.fscore > 0) &( fbpl.post.ptype == \'video\') )  ).select() #| ((fbpl.post.team == candidate) & (fbpl.post.created_time >= week ))\n            for row in rows:\n                hour48_video_likes += row.likes_count48\n                hour48_video_comments += row.comment_count48\n                hour48_video_shares += row.shares_count48\n\n            hour48_active_videos = len(rows)\n\n            date_time = datetime.datetime.utcnow().strftime(\'%Y%m%d\')\n            date_time = datetime.datetime.strptime(date_time, \'%Y%m%d\')\n            \n            checkins=0\n            likes=0\n            were_here_count=0\n            talking_about_count=0\n            checkins24=0\n            likes24=0\n            were_here_count24=0\n            talking_about_count24=0\n            \n            \n            Pages = fbpl(fbpl.page.team == candidate).select()\n            \n            for page in Pages:\n                \n                checkins += page.checkins\n                likes += page.likes\n                were_here_count += page.were_here_count\n                talking_about_count += page.talking_about_count\n                checkins24 += page.checkins24\n                likes24 += page.likes24\n                were_here_count24 += page.were_here_count24\n                talking_about_count24 += page.talking_about_count24\n\n            # check it team_counts has data in the same date, if YES, update the record, if NOT, then insert the new records.\n\n            row = fbpl( ((fbpl.team_counts.team == candidate)  & ( fbpl.team_counts.date_time == date_time))).select().first()\n            \n            if row:\n                row.update_record(checkins=checkins, likes=likes, were_here_count=were_here_count, talking_about_count=talking_about_count, total_active_posts=total_active_posts, total_post_likes=total_post_likes, total_post_comments=total_post_comments ,total_post_shares=total_post_shares, hour48_post_likes=hour48_post_likes, hour48_post_comments=hour48_post_comments, hour48_post_shares=hour48_post_shares, hour48_active_posts = hour48_active_posts, hour48_active_links =hour48_active_links, hour48_link_likes = hour48_link_likes, hour48_link_comments = hour48_link_comments, hour48_link_shares = hour48_link_shares, hour48_active_videos = hour48_active_videos, hour48_video_likes = hour48_video_likes, hour48_video_comments = hour48_video_comments, hour48_video_shares = hour48_video_shares, hour48_active_stories = hour48_active_stories, hour48_story_likes = hour48_story_likes, hour48_story_comments = hour48_story_comments, hour48_story_shares = hour48_story_shares, checkins24=checkins24, likes24=likes24, were_here_count24=were_here_count24, talking_about_count24=talking_about_count24)\n            else:\n                fbpl.team_counts.insert( team = candidate, date_time = date_time, checkins=checkins, likes=likes, were_here_count=were_here_count, talking_about_count=talking_about_count, total_active_posts=total_active_posts, total_post_likes=total_post_likes, total_post_comments=total_post_comments ,total_post_shares=total_post_shares, hour48_post_likes=hour48_post_likes, hour48_post_comments=hour48_post_comments, hour48_post_shares=hour48_post_shares, hour48_active_posts = hour48_active_posts, hour48_active_links =hour48_active_links, hour48_link_likes = hour48_link_likes, hour48_link_comments = hour48_link_comments, hour48_link_shares = hour48_link_shares, hour48_active_videos = hour48_active_videos, hour48_video_likes = hour48_video_likes, hour48_video_comments = hour48_video_comments, hour48_video_shares = hour48_video_shares, hour48_active_stories = hour48_active_stories, hour48_story_likes = hour48_story_likes, hour48_story_comments = hour48_story_comments, hour48_story_shares = hour48_story_shares, checkins24=checkins24, likes24=likes24, were_here_count24=were_here_count24, talking_about_count24=talking_about_count24)\n                fbpl.commit()\n            \n    except:\n        raise\n        #errorMsg=  "Unexpected error:", sys.exc_info()[0]\n    return errorMsg\n\n\n#8\ndef dailySum():\n    \n\n    \n    candidates = []\n    candidates.append("\xe9\x80\xa3\xe5\x8b\x9d\xe6\x96\x87")\n    candidates.append("\xe6\x9f\xaf\xe6\x96\x87\xe5\x93\xb2")\n    candidates.append("\xe9\xa1\xa7\xe7\xab\x8b\xe9\x9b\x84")\n    date = datetime.datetime.strptime("2014-04-29 00:00:00", \'%Y-%m-%d %H:%M:%S\')\n    \n    while date <= datetime.datetime.now():\n        #list=[]\n        for candidate in candidates:\n            dailyPagelikes=0\n            talkingAbout=0\n            dailyPosts = 0\n            dailyPostLikes=0\n            dailyPostComments=0\n            dailyPostShares=0\n            pages = fbpl(fbpl.page.team == candidate).select(fbpl.page.ALL)\n            date2 = date + datetime.timedelta(hours=24)\n            #date3 = date - datetime.timedelta(hours=24)\n            for page in pages:\n                likes1 = fbpl((fbpl.social_counts.placeid == page.pageid) & (fbpl.social_counts.updated_time >= date) ).select().first()\n                likes2 = fbpl((fbpl.social_counts.placeid == page.pageid) & (fbpl.social_counts.updated_time >= date2)).select().first()\n                \n                \n                \n                if likes1:\n                    if likes2 :\n                        dailyPagelikes += (likes2.likes - likes1.likes)\n                        talkingAbout += (likes1.talking_about_count + likes2.talking_about_count)/2\n                \n                post1 =  fbpl((fbpl.post.from_id == str(page.pageid))).select()\n                list= []\n                for post in post1:\n                    list = getPostCountDate(post.fid, date.strftime(\'%Y-%m-%d\'), date2.strftime(\'%Y-%m-%d\'))\n                   \n                    dailyPostLikes = dailyPostLikes +  list[0]\n                    dailyPostComments =  dailyPostComments  +  list[1]\n                    dailyPostShares = dailyPostShares  +  list[2]\n                    \n                    \n            Posts = fbpl((fbpl.post.team == candidate) & (fbpl.post.status_type <> \'\') & (fbpl.post.created_time >= date) & (fbpl.post.created_time < date2) ).select()\n            dailyPosts =len(Posts)\n            \n            row = fbpl((fbpl.dailySum.date == date) & (fbpl.dailySum.team == candidate) ).select().first()\n            if row:\n                row.update_record(dailyPagelikes=dailyPagelikes, talkingAbout=talkingAbout,team=candidate, dailyPosts=dailyPosts, dailyPostLikes=dailyPostLikes, dailyPostComments=dailyPostComments, dailyPostShares=dailyPostShares)\n            else:\n                fbpl.dailySum.insert(date=date,dailyPagelikes=dailyPagelikes, talkingAbout=talkingAbout,team=candidate, dailyPosts=dailyPosts, dailyPostLikes=dailyPostLikes, dailyPostComments=dailyPostComments, dailyPostShares=dailyPostShares)\n                fbpl.commit()\n        date += datetime.timedelta(hours=24) \n    return "OK"\n\n\n\n#Field(\'dailyPagelikes\',\'integer\'), Field(\'talkingAbout\',\'integer\'), Field(\'dailyPosts\',\'integer\'),Field(\'dailyPostLikes\',\'integer\'), #Field(\'dailyPostComments\',\'integer\'), Field(\'dailyPostShares\',\'integer\')\n\n\ndef test2():\n    now= datetime.datetime.utcnow()\n    #month2 = (now - datetime.timedelta(hours=24*28*2)).strftime(\'%Y-%m-%dT%H:%M:%S\') #2014-04-24T17:57:21+0000\n    #hour48 = (now - datetime.timedelta(hours=72)).strftime(\'%Y-%m-%d %H:%M:%S\')\n    #hour48 = datetime.datetime.strptime(hour48,\'%Y-%m-%d %H:%M:%S\')\n    #now= datetime.datetime.utcnow()\n    #week2 = (now - datetime.timedelta(hours=24*14)).strftime(\'%Y-%m-%dT%H:%M:%S+0000\') #2014-04-24T17:57:21+0000\n    #month2 = datetime.datetime.strptime(month2,\'%Y-%m-%dT%H:%M:%S+0000\')\n    now = datetime.datetime.utcnow()\n    week2 = (now - datetime.timedelta(hours=24*14)).strftime(\'%Y-%m-%d %H:%M:%S+0000\')\n    rows = fbpl(( fbpl.post.tscore <> 0) | (fbpl.post.created_time > week2 ) ).select(fbpl.post.fid)\n\n    #row = fbpl(fbpl.post.created_time >= week2).select(fbpl.post.ALL).first()\n    return str(rows) #row.date_time\n\n\n\ndef hourdiff(now, hour):\n    hour = (now - datetime.timedelta(hours=hour)).strftime(\'%Y-%m-%d %H:%M:%S\')\n    hour = datetime.datetime.strptime(hour,\'%Y-%m-%d %H:%M:%S\')\n\n    return hour\n\n\n\n\ndef getOpengraphImage(url):\n    op={}\n    image=\'\'\n    if (url and url<>""):\n        try:\n            op = ExtendedOpenGraph.parse(url)\n            image = op[\'image\']\n        except:\n            image=\'\'\n    return image\n\n\n@auth.requires_login()\ndef index():\n    user = auth.user\n    response.flash = T(\'You are %(name)s\', dict(name=user[\'first_name\']))\n    if  len(request.args) >= 2 and request.args[0] == \'id\':\n        fb_id = request.args[1]\n    else:\n        fb_id = \'me\'\n\n    graph = getGraph()\n    try:\n        fb_obj = graph.get_object(fb_id, metadata=1)\n    except GraphAPIError, e:\n        response.flash = "%s [%s: %s]" % (T("Logging you out!"),__name__, e)\n        redirect(auth.url(f=\'user\', args=\'logout\'))\n\n    response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=T(\'You are at  %(fb_id)s\', dict(fb_id=fb_id)))\n\n@auth.requires_login()\ndef connection():\n    user = auth.user\n    if not len(request.args) >= 2:\n        return None\n    fb_id = request.args[0]\n    fb_connection_name = request.args[1]\n    try:\n        connections = getGraph().get_connections(fb_id, fb_connection_name)\n    except GraphAPIError, e:\n        response.flash = "%s [%s: %s]" % (T("Logging you out!"),__name__, e)\n        redirect(auth.url(f=\'user\', args=\'logout\'))\n\n\n    response.menu=[[v[\'name\'], False, URL(r=request, f=\'index\', args=[\'id\', v[\'id\']])]  for v in connections[\'data\']]\n    return dict(message=T(\'Looking list of %(conn_name)s of %(id)s\', dict(conn_name=fb_connection_name, id=fb_id)))\n\n\n\n\n@auth.requires_login()\ndef loading_list():\n    user = auth.user\n    import csv, sys\n    import datetime\n    import time\n\n    graph = getGraph()\n    reader = open(\'/Users/logyuan/Dropbox/FB_socialcount/keelung.csv\', "U")\n    errorMsg = \'\'\n    for fbplace in csv.reader(reader):\n        try:\n            id = str(fbplace[0])\n            row = fbpl.place(placeid=id)\n            if not row:\n                try:\n                    fb_obj = graph.get_object(str(fbplace[0]))\n                    #id= fb_obj["id"]\n                    name =  fb_obj["name"]\n                    category = fb_obj["category"]\n                    link= fb_obj["link"]\n                    #checkins= fb_obj["checkins"]\n                    zip= fb_obj["location"]["zip"]\n                    try:\n                        category_list =  fb_obj["category_list"]\n                    except:\n                        category_list = \'\'\n                    try:\n                        latitude= fb_obj["location"]["latitude"]\n                        longitude= fb_obj["location"]["longitude"] if (fb_obj["location"]["longitude"]) else ""\n                    except:\n                        latitude =\'\'\n                        longitude=\'\'\n                    fbpl.place.insert(placeid=id,name = name,latitude=latitude,longitude=longitude,category=category,category_list=category_list,zip=zip,link=link)\n                except GraphAPIError, e:\n                    errorMsg = errorMsg + \'errorID:\'  + str(fbplace[0]) + \'errorMessage: \' +  str(e) + \',\'\n                fbpl.commit()\n                message=\'Successfully adding new place into the database\'\n\n                time.sleep(8)\n        except GraphAPIError, e:\n            errorMsg = errorMsg + \'errorID:\'  + str(fbplace[0])  + \' errorMessage:\'  +  str(e) + \',\'\n    reader.close()\n        # or "rU"\n\n    return dict(message=T(\'list complete\'),errorMsg=errorMsg )\n\n\n\n\n@auth.requires_login()\ndef getPost(gid):\n    graph = getGraph()\n    try:\n        if gid:\n            fb_obj = graph.request(gid,args={\'fields\': \'id, message, updated_time, from, created_time, status_type, type, link, likes.limit(1).summary(true), shares, comments.limit(1).summary(true), object_id, picture\'})\n            fid= fb_obj["id"]\n            message =  fb_obj["message"] if (\'message\' in fb_obj) else \'\'\n            created_time = datetime.datetime.strptime(fb_obj["created_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'created_time\' in fb_obj) else \'\'\n            updated_time = datetime.datetime.strptime(fb_obj["updated_time"],\'%Y-%m-%dT%H:%M:%S+0000\') if  (\'updated_time\' in fb_obj) else \'\'\n            from_id = fb_obj["from"]["id"] if (\'from\' in fb_obj) else \'\'\n            from_name = fb_obj["from"]["name"] if (\'from\' in fb_obj) else \'\'\n            status_type = fb_obj["status_type"] if (\'status_type\' in fb_obj) else \'\'\n            ptype = fb_obj["type"] if (\'type\' in fb_obj) else \'\'\n            status_type = fb_obj["status_type"] if (\'status_type\' in fb_obj) else \'\'\n            link =  fb_obj["link"] if (\'link\' in fb_obj) else \'\'\n            #picture =  fb_obj["picture"] if (\'picture\' in fb_obj) else \'\'\n            shares_count = fb_obj["shares"][\'count\'] if (\'shares\' in fb_obj) else 0\n            likes_count = fb_obj["likes"]["summary"]["total_count"] if (\'summary\' in fb_obj) else 0\n            comment_count = fb_obj["comments"]["summary"]["total_count"] if (\'summary\' in fb_obj) else 0\n            object_id = fb_obj["object_id"] if (\'object_id\' in fb_obj) else \'\'\n            row=fbpl(fbpl.page.pageid==from_id).select().first()\n            team = row[\'team\']\n            if (ptype == \'link\' ) | (ptype == \'video\'):\n                try:\n                    picture =getOpengraphImage(link)\n                    if picture == \'\':\n                        picture = post["picture"] if (\'picture\' in post) else \'\'\n                except:\n                    picture = post["picture"] if (\'picture\' in post) else \'\'\n            elif (ptype == \'photo\' ) :\n                try:\n                    images=[]\n                    images =graph.request(object_id , args={\'fields\':\'images\'})["images"]\n                    for image in images:\n                        if (image["height"] > 200):\n                            picture = image["source"]\n                except:\n                    picture = post["picture"] if (\'picture\' in post) else \'\'\n            else:\n                picture = post["picture"] if (\'picture\' in post) else \'\'\n\n\n            row = fbpl(fbpl.post.fid==from_id).select().first()\n            if row:\n                row.update_record(fid=fid, message=message,from_id=from_id, from_name=from_name, created_time=created_time,object_id=object_id,ptype=ptype,status_type=status_type, link=link, picture=picture ,shares_count=shares_count,likes_count=likes_count,comment_count=comment_count,team=team, updated_time=updated_time)\n            else:\n                fbpl.post.insert(fid=fid, message=message,from_id=from_id, from_name=from_name, created_time=created_time,object_id=object_id,ptype=ptype,status_type=status_type, link=link, picture=picture ,shares_count=shares_count,likes_count=likes_count,comment_count=comment_count,team=team, updated_time=updated_time)\n                fbpl.commit()\n            message=\'Successfully adding new post into the database\'\n        else:\n            message=\'failure, please check your postid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=gid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n\n@auth.requires_login()\ndef getPage(gid,team):\n    graph = getGraph()\n    try:\n        if gid:\n            fb_obj = graph.request(gid ,args={\'fields\': \'id, name, category, about, can_post, checkins, talking_about_count, were_here_count, link,description, cover, website, picture.type(large), is_published,likes.limit(1).summary(true), insights\'})\n            id= fb_obj["id"]\n            pageid = fb_obj["id"]\n            name =  fb_obj["name"] if (\'name\' in fb_obj) else \'\'\n            category = fb_obj["category"] if (\'category\' in fb_obj) else \'\'\n            about = fb_obj["about"] if (\'about\' in fb_obj) else \'\'\n            can_post = fb_obj["can_post"] if (\'can_post\' in fb_obj) else \'\'\n            is_published = fb_obj["is_published"] if (\'is_published\' in fb_obj) else \'\'\n            talking_about_count = fb_obj["talking_about_count"] if (\'talking_about_count\' in fb_obj) else 0\n            were_here_count = fb_obj["were_here_count"] if (\'were_here_count\' in fb_obj) else 0\n            link = fb_obj["link"] if (\'link\' in fb_obj) else \'\'\n            likes = fb_obj["likes"] if (\'likes\' in fb_obj) else \'\'\n            description = fb_obj["description"] if (\'description\' in fb_obj) else \'\'\n            cover_id = fb_obj["cover"]["cover_id"] if (\'cover\' in fb_obj) else \'\'\n            source = fb_obj["cover"]["source"] if (\'cover\' in fb_obj) else \'\'\n            picture = fb_obj["picture"]["data"]["url"] if (\'picture\' in fb_obj) else \'\'\n            team=team\n            website = fb_obj["website"] if (\'website\' in fb_obj) else \'\'\n            row = fbpl(fbpl.page.pageid==id).select().first()\n            if row :\n                row.update_record(name=name, category=category, about=about, can_post=can_post, is_published=is_published, link=link, description=description, cover_id=cover_id, source=source,website=website,talking_about_count=talking_about_count,were_here_count=were_here_count,picture=picture,team=team)\n            else:\n                fbpl.page.insert(pageid=pageid,name=name, category=category, about=about, can_post=can_post, is_published=is_published, link=link, description=description, cover_id=cover_id, source=source,website=website,talking_about_count=talking_about_count,were_here_count=were_here_count,picture=picture,team=team)\n            fbpl.commit()\n            message=\'Successfully adding new page into the database\'\n        else:\n            message=\'failure, please check your pageid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=gid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n@auth.requires_login()\ndef getPlace(gid):\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        gid = checkGraphId(gid)\n        if gid <> \'0\':\n            fb_obj = graph.get_object(gid)\n            row = fbpl.place(placeid=gid)\n            if not row:\n                name =  fb_obj["name"] if (\'name\' in fb_obj) else \'\'\n                category = fb_obj["category"] if (\'category\' in fb_obj) else \'\'\n                category_list =  fb_obj["category_list"] if (\'category_list\' in fb_obj) else \'\'\n                link= fb_obj["link"] if (\'link\' in fb_obj) else \'\'\n                website =fb_obj["website"] if (\'website\' in fb_obj) else \'\'\n                phone =fb_obj["phone"] if (\'phone\' in fb_obj) else \'\'\n                description =fb_obj["description"] if (\'description\' in fb_obj) else \'\'\n\n                if (\'location\' in fb_obj):\n                    zip= fb_obj["location"]["zip"] if (\'zip\' in fb_obj["location"]) else \'\'\n                    street= fb_obj["location"]["street"] if (\'street\' in fb_obj["location"]) else \'\'\n                    city= fb_obj["location"]["city"] if (\'city\' in fb_obj["location"]) else \'\'\n                    state= fb_obj["location"]["state"] if (\'state\' in fb_obj["location"]) else \'\'\n                    country=fb_obj["location"]["country"] if (\'country\' in fb_obj["location"]) else \'\'\n                    latitude= fb_obj["location"]["latitude"] if (\'latitude\' in fb_obj["location"]) else \'\'\n                    longitude= fb_obj["location"]["longitude"] if (\'longitude\' in fb_obj["location"]) else \'\'\n                    mutiple = \'No\'\n                else:\n                    zip= \'\'\n                    street= \'\'\n                    city= \'\'\n                    state= \'\'\n                    country= \'\'\n                    latitude= \'\'\n                    longitude= \'\'\n                old_ids = \'\'\n                fbpl.place.insert(placeid=gid,name = name,latitude=latitude,longitude=longitude,category=category,category_list=category_list,zip=zip,link=link,old_ids=old_ids)\n\n            fbpl.commit()\n            message=\'Successfully adding new place into the database\'\n        else:\n            message=\'failure, please check your placeid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=gid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n\n@auth.requires_login()\ndef getPlace_f():\n    graph = getGraph()\n    try:\n        if request.vars[\'gid\']:\n            gid = request.vars[\'gid\']\n            fb_obj = graph.get_object(gid)\n            id= fb_obj["id"]\n            row = fbpl.place(placeid=id)\n            if not row:\n                name =  fb_obj["name"]\n                category = fb_obj["category"]\n                category_list =  fb_obj["category_list"]\n                checkins= fb_obj["checkins"]\n                zip= fb_obj["location"]["zip"]\n                latitude= fb_obj["location"]["latitude"]\n                longitude= fb_obj["location"]["longitude"]\n                link= fb_obj["link"]\n                old_ids = \'\'\n                fbpl.place.insert(placeid=id,name = name,latitude=latitude,longitude=longitude,category=category,category_list=category_list,zip=zip,link=link,old_ids=old_ids)\n\n            fbpl.commit()\n            message=\'Successfully adding new place into the database\'\n        else:\n            message=\'failure, please check your placeid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n\n\n    return dict(message=message)\n\n@auth.requires_login()\ndef getEvent(eid):\n    graph = getGraph()\n    try:\n        event= graph.get_object(eid)\n        eventid = event["id"] if \'id\' in event else \'\'\n        row = fbpl.event(eventid=eventid)\n        if not row:\n            description = event["description"] if \'description\' in event else \'\'\n            end_time  = event["end_time"] if \'end_time\' in event else \'\'\n            timezone = event["timezone"] if \'timezone\' in event else \'\'\n            name = event["name"] if \'name\' in event else \'\'\n            location = event["location"] if \'location\' in event else \'\'\n            ownerid = event["owner"]["id"] if \'owner\' in event else \'\'\n            picture = event["picture"] if \'picture\' in event else \'\'\n            privacy = event["privacy"] if \'privacy\' in event else \'\'\n            start_time = event["start_time"] if \'start_time\' in event else \'\'\n            ticket_uri = event["ticket_uri"] if \'ticket_uri\' in event else \'\'\n            updated_time = event["updated_time"] if \'updated_time\' in event else \'\'\n            is_date_only  = event["is_date_only"] if \'is_date_only\' in event else \'\'\n            if \'venue\' in event:\n                venueid  = event["venue"]["id"] if \'id\' in event["venue"] else \'\'\n                venuename = event["venue"]["name"] if \'name\' in event["venue"] else \'\'\n                country = event["venue"]["country"] if \'country\' in event["venue"] else \'\'\n                city = event["venue"]["city"] if \'city\' in event["venue"] else \'\'\n                state  = event["venue"]["state"] if \'state\' in event["venue"] else \'\'\n                street = event["venue"]["street"] if \'street\' in event["venue"] else \'\'\n                zipcode = event["venue"]["zip"] if \'zip\' in event["venue"] else \'\'\n                longitude = event["venue"]["longitude"] if \'longitude\' in event["venue"] else \'\'\n                latitude  = event["venue"]["latitude"] if \'latitude\' in event["venue"] else \'\'\n            fbpl.event.insert(eventid=eventid, description=description, end_time=end_time, timezone=timezone, name=name, location=location, ownerid=ownerid, picture=picture, privacy=privacy, start_time=start_time, ticket_uri=ticket_uri, updated_time=updated_time, is_date_only=is_date_only, venuename=venuename, venueid=venueid, country=country, city=city, state=state, street=street, zipcode=zipcode, longitude=longitude, latitude=latitude)\n            fbpl.commit()\n            message=\'Successfully adding new event into the database\'\n        else:\n            message=\'failure, please check your eventid!\'\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=eventid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n    return dict(message=message)\n\n@auth.requires_login()\ndef getSocialCount():\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        if request.vars[\'gid\']:\n            oid = request.vars[\'gid\']\n        else:\n            message=\'failure, please check your placeid!\'\n            return dict(message=message)\n        pid = checkGraphId(oid)\n        if pid <> \'0\':\n            if pid <> oid :\n                record = fbpl(fbpl.place.placeid==oid).select().first()\n                record2 = fbpl(fbpl.place.placeid==pid).select().first()\n                if not (record2) :\n                   getPlace(pid)\n                   time.sleep(1)\n                   record2 = fbpl(fbpl.place.placeid==pid).select().first()\n                   oids = []\n                   oids.append(oid)\n                   record2.update_record(old_ids=oids)\n                   fbpl(fbpl.place.placeid==oid).delete()\n                else:\n                   fbpl(fbpl.place.placeid==oid).delete()\n                   oids = []\n                   oids.append(record2.old_ids)\n                   oids.append(oid)\n                   record2.update_record(old_ids=oids)\n            fb_obj = graph.get_object(pid)\n            try:\n                checkins =  fb_obj["checkins"]\n            except:\n                checkins=\'\'\n            try:\n                likes= fb_obj["likes"]\n            except:\n                likes=\'\'\n            try:\n                were_here_count= fb_obj["were_here_count"]\n            except:\n                were_here_count=\'\'\n            date_time = datetime.datetime.utcnow()\n            fbpl.social_counts.insert(placeid=pid,checkins = checkins,likes=likes,date_time=date_time,were_here_count=were_here_count)\n            fbpl.commit()\n            time.sleep(1.1)\n            message=\'Successfully found the place\'\n            return dict(message=message)\n        else:\n            return dict(message=\'failure, please check your placeid!\')\n\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pid,date_time=datetime.datetime.utcnow(),error_msg=message)\n        fbpl.commit()\n\n    #response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=message)  #dict(message=str[9])\n\n@auth.requires_login()\ndef getSocialCount_f(gid):\n    import datetime\n    import time\n    graph = getGraph()\n    try:\n        if gid:\n            oid = gid\n        else:\n            message=\'failure, please check your placeid!\'\n            return dict(message=message)\n        pid = checkGraphId(oid)\n        if pid <> \'0\':\n            if pid <> oid :\n                record = fbpl(fbpl.place.placeid==oid).select().first()\n                record2 = fbpl(fbpl.place.placeid==pid).select().first()\n                if not (record2) :\n                    getPlace(pid)\n                    time.sleep(1)\n                    record2 = fbpl(fbpl.place.placeid==pid).select().first()\n                    oids = []\n                    oids.append(oid)\n                    record2.update_record(old_ids=oids)\n                    fbpl(fbpl.place.placeid==oid).delete()\n                else:\n                   fbpl(fbpl.place.placeid==oid).delete()\n                   oids = []\n                   oids.append(record2.old_ids)\n                   oids.append(oid)\n                   record2.update_record(old_ids=oids)\n            fb_obj = graph.get_object(pid)\n            try:\n                checkins =  fb_obj["checkins"]\n            except:\n                checkins=\'\'\n            try:\n                likes= fb_obj["likes"]\n            except:\n                likes=\'\'\n            try:\n                were_here_count= fb_obj["were_here_count"]\n            except:\n                were_here_count=\'\'\n            date_time = datetime.datetime.today()\n            fbpl.social_counts.insert(placeid = pid, checkins = checkins,likes=likes,date_time=date_time,were_here_count=were_here_count)\n            fbpl.commit()\n            time.sleep(1.1)\n            message=\'Successfully found the place\'\n            return dict(message=message)\n        else:\n            return dict(message=\'failure, please check your placeid!\')\n\n    except GraphAPIError, e:\n        message=e.result\n        fbpl.graphAPI_Error.insert(placeid=pid,date_time=datetime.datetime.today(),error_msg=message)\n        fbpl.commit()\n    except:\n        raise\n\n    #response.menu = [[k, False, URL(r=request, f=\'connection\', args=[fb_id,k])] for k,v in  fb_obj[\'metadata\'][\'connections\'].items()]\n    return dict(message=message)  #dict(message=str[9])\n\n\n\n\n\n@auth.requires_login()\ndef checkGraphId_f():\n    import datetime\n    import time\n    graph = getGraph()\n    if request.vars[\'gid\']:\n        graphid = request.vars[\'gid\']\n    else:\n        return dict(message=\'failure, please check your placeid!\')\n\n    new_graphid = graphid\n    try:\n        fb_obj = graph.get_object(graphid)\n    except GraphAPIError, r:\n        message=r.result\n        code =message[\'error\'][\'code\']\n        fbpl.graphAPI_Error.insert(placeid=graphid,date_time=datetime.datetime.today(),code =code,error_msg=message)\n        fbpl.commit()\n        if code == 21:\n            id=message[\'error\'][\'message\'].split(\' \')\n            new_graphid = id[9].strip(\'.\')\n            try:\n                fb_obj = graph.get_object(new_graphid)\n            except GraphAPIError, e:\n                time.sleep(1)\n                new_graphid = checkGraphId(new_graphid)\n            try:\n                row = fbpl.place(placeid=graphid)\n                fbpl.merged_place.insert(placeid=graphid,date_time=datetime.datetime.today(),merge_to = new_graphid,name = row.name, latitude=row.latitude,longitude=row.longitude,category=row.category,category_list=row.category_list,zip=row.zip,link=row.link,old_ids=row.old_ids)\n            except:\n                message = \'No this id in the DB\'\n        else:\n            new_graphid = \'0\'\n\n    return new_graphid\n\n\n\n\n@auth.requires_login()\ndef checkGraphId(graphid):\n    import datetime\n    import time\n    graph = getGraph()\n    new_graphid = graphid\n    try:\n        fb_obj = graph.get_object(graphid)\n    except GraphAPIError, r:\n        message=r.result\n        code =message[\'error\'][\'code\']\n        fbpl.graphAPI_Error.insert(placeid=graphid,date_time=datetime.datetime.today(),code =code,error_msg=message)\n        fbpl.commit()\n        if code == 21:\n            id=message[\'error\'][\'message\'].split(\' \')\n            new_graphid = id[9].strip(\'.\')\n            try:\n                fb_obj = graph.get_object(new_graphid)\n            except GraphAPIError, e:\n                time.sleep(1)\n                new_graphid = checkGraphId(new_graphid)\n            try:\n                row = fbpl.place(placeid=graphid)\n                fbpl.merged_place.insert(placeid=graphid,date_time=datetime.datetime.today(),merge_to = new_graphid,name = row.name, latitude=row.latitude,longitude=row.longitude,category=row.category,category_list=row.category_list,zip=row.zip,link=row.link,old_ids=row.old_ids)\n            except:\n                message = \'No this id in the DB\'\n        else:\n            new_graphid = \'0\'\n\n    return new_graphid\n\n\n@auth.requires_login()\ndef countAllPlaceSocialCount():\n    import datetime\n    import time\n\n    graph = getGraph()\n    rows = fbpl().select(fbpl.place.placeid,fbpl.place.old_ids, orderby=fbpl.place.id)\n    start_date_time=datetime.datetime.today()\n\n    for row in rows:\n        pid= row.placeid\n        #check if the Facebook has the graphic\n        getSocialCount_f(pid)\n\n    end_date_time=datetime.datetime.today()\n    fbpl.update_log.insert(start_date_time=start_date_time,end_date_time=end_date_time)\n    message = \'Successfully update socialcount of places\'\n    return dict(message=message)\n\n\n\n\n\n\n\n\n\n@auth.requires_login()\ndef countTscore():\n    #fbpl(fbpl.post.id>0).update(tscore= fbpl.post.likes_count*0.2+fbpl.post.shares_count*0.5+fbpl.post.comment_count*0.3)\n    rows= fbpl().select(fbpl.post.ALL)\n    for row in rows:\n        tscore = row.shares_count*0.5 + row.comment_count*0.3 + row.likes_count*0.2\n        row.update_record(tscore=tscore)\n    return "success"\n\n\n\n@auth.requires_login()\ndef getPageCount(fid, hour, day):\n\n    now = datetime.datetime.now()\n    hours = hour + day*24\n    from_date = hourdiff(now,hours)\n\n    rows = fbpl((fbpl.social_counts.placeid==fid) & (fbpl.social_counts.date_time >= from_date )).select( orderby= ~fbpl.social_counts.date_time)\n    if rows:\n        total_page_checkins= rows.first()[\'checkins\'] - rows.last()[\'checkins\']\n        total_page_likes = rows.first()[\'likes\'] - rows.last()[\'likes\']\n        total_page_whc = rows.first()[\'were_here_count\'] - rows.last()[\'were_here_count\']\n        total_page_tac = rows.first()[\'talking_about_count\'] - rows.last()[\'talking_about_count\']\n    else:\n        total_page_checkins= 0\n        total_page_likes = 0\n        total_page_whc = 0\n        total_page_tac = 0\n    result = [total_page_checkins,total_page_likes,total_page_whc,total_page_tac]\n    return result\n\n\n\n@auth.requires_login()\ndef getPostCount(fid, hour, day):\n    #fid, hour, day\n    #hour =96\n    #day = 0\n    #fid = \'466328090135843\'\n\n    now = datetime.datetime.now()\n    hours = hour + day*24\n    from_date = hourdiff(now,hours)\n\n    rows = fbpl((fbpl.post_counts.fid==fid) & (fbpl.post_counts.date_time >= from_date )).select( orderby= ~fbpl.post_counts.date_time)\n    if rows:\n        total_post_likes = rows.first()[\'likes_count\'] - rows.last()[\'likes_count\']\n        total_post_comments = rows.first()[\'comment_count\'] - rows.last()[\'comment_count\']\n        total_post_shares = rows.first()[\'shares_count\'] - rows.last()[\'shares_count\']\n    else:\n        total_post_likes = \'\'\n        total_post_comments = \'\'\n        total_post_shares = \'\'\n    result = [total_post_likes,total_post_comments,total_post_shares]\n    return result\n\n\n\n@auth.requires_login()\ndef getPageCountDate(fid, from_date, to_date):\n    #fid, from_date, to_date\n    #fid = \'543656759040101\'\n    #from_date = \'2014-4-25\'\n    #to_date = \'2014-4-30\'\n    from_date = datetime.datetime.strptime(from_date,\'%Y-%m-%d\')\n    to_date = datetime.datetime.strptime(to_date,\'%Y-%m-%d\')\n\n    rows = fbpl((fbpl.social_counts.placeid==fid) & (fbpl.social_counts.date_time >= from_date ) & (fbpl.social_counts.date_time <= to_date )).select()\n\n    if rows:\n        total_page_checkins= rows.first()[\'checkins\'] - rows.last()[\'checkins\']\n        total_page_likes = rows.first()[\'likes\'] - rows.last()[\'likes\']\n        total_page_whc = rows.first()[\'were_here_count\'] - rows.last()[\'were_here_count\']\n        total_page_tac = (rows.first()[\'talking_about_count\'] + rows.last()[\'talking_about_count\'])/2\n    else:\n        total_page_checkins=\'\'\n        total_page_likes = \'\'\n        total_page_whc = \'\'\n        total_page_tac = \'\'\n\n    result = [total_page_checkins,total_page_likes,total_page_whc,total_page_tac]\n    return result\n\n@auth.requires_login()\ndef getPostCountDate(fid, from_date, to_date):\n\n    from_date = datetime.datetime.strptime(from_date,\'%Y-%m-%d\')\n    to_date = datetime.datetime.strptime(to_date,\'%Y-%m-%d\')\n\n    rows = fbpl((fbpl.post_counts.fid==fid) & (fbpl.post_counts.updated_time >= from_date ) ).select()\n    rows1 = fbpl((fbpl.post_counts.fid==fid) & (fbpl.post_counts.updated_time >= to_date )).select()\n    if rows:\n        if rows1:\n            total_post_likes = rows1.first()[\'likes_count\'] - rows.first()[\'likes_count\']\n            total_post_comments = rows1.first()[\'comment_count\'] - rows.first()[\'comment_count\']\n            total_post_shares = rows1.first()[\'shares_count\'] - rows.first()[\'shares_count\']\n        else:\n            total_post_likes = rows.last()[\'likes_count\'] - rows.first()[\'likes_count\']\n            total_post_comments = rows.last()[\'comment_count\'] - rows.first()[\'comment_count\']\n            total_post_shares = rows.last()[\'shares_count\'] - rows.first()[\'shares_count\']            \n    else:\n        total_post_likes = 0\n        total_post_comments = 0\n        total_post_shares = 0\n\n    result = [total_post_likes,total_post_comments,total_post_shares]\n    return result\n\nresponse._vars=response._caller(collect_posts)\n'
p7
sS'snapshot'
p8
(dp9
S'exception'
p10
(dp11
S'__module__'
p12
S"'urllib2'"
p13
sS'__getslice__'
p14
S"<method-wrapper '__getslice__' of URLError object>"
p15
sS'__str__'
p16
S"<bound method URLError.__str__ of URLError(error(65, 'No route to host'),)>"
p17
sS'__reduce__'
p18
S'<built-in method __reduce__ of URLError object>'
p19
sS'__dict__'
p20
S"{'reason': error(65, 'No route to host')}"
p21
sS'__sizeof__'
p22
S'<built-in method __sizeof__ of URLError object>'
p23
sS'__weakref__'
p24
S'None'
p25
sS'__init__'
p26
S"<bound method URLError.__init__ of URLError(error(65, 'No route to host'),)>"
p27
sS'__setattr__'
p28
S"<method-wrapper '__setattr__' of URLError object>"
p29
sS'__reduce_ex__'
p30
S'<built-in method __reduce_ex__ of URLError object>'
p31
sS'__new__'
p32
S'<built-in method __new__ of type object>'
p33
sS'errno'
p34
S'None'
p35
sS'__format__'
p36
S'<built-in method __format__ of URLError object>'
p37
sS'__class__'
p38
S"<class 'urllib2.URLError'>"
p39
sS'filename'
p40
S'None'
p41
sS'__doc__'
p42
S'None'
p43
sS'__getitem__'
p44
S"<method-wrapper '__getitem__' of URLError object>"
p45
sS'__setstate__'
p46
S'<built-in method __setstate__ of URLError object>'
p47
sS'__getattribute__'
p48
S"<method-wrapper '__getattribute__' of URLError object>"
p49
sS'args'
p50
S"(error(65, 'No route to host'),)"
p51
sS'reason'
p52
S"error(65, 'No route to host')"
p53
sS'__subclasshook__'
p54
S'<built-in method __subclasshook__ of type object>'
p55
sS'__unicode__'
p56
S'<built-in method __unicode__ of URLError object>'
p57
sS'strerror'
p58
S'None'
p59
sS'__delattr__'
p60
S"<method-wrapper '__delattr__' of URLError object>"
p61
sS'__repr__'
p62
S"<method-wrapper '__repr__' of URLError object>"
p63
sS'__hash__'
p64
S"<method-wrapper '__hash__' of URLError object>"
p65
ssS'evalue'
p66
S'<urlopen error [Errno 65] No route to host>'
p67
sS'request'
p68
cgluon.html
XML_unpickle
p69
(S's\xf2V\x00\x00<div><table><tr><td style="font-weight:bold;vertical-align:top;">ajax</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">application</td><td style="vertical-align:top;">:</td><td><div>fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">args</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cid</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">client</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">controller</td><td style="vertical-align:top;">:</td><td><div>graphAPI</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cookies</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">session_id_admin</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1-2a34b6e8-7adc-42f3-a1be-7dc754917077<table><tr><td style="font-weight:bold;vertical-align:top;">comment</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">domain</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">expires</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">httponly</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">max-age</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">path</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">secure</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">version</td><td style="vertical-align:top;">:</td><td><div></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_id_fbmayor</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93<table><tr><td style="font-weight:bold;vertical-align:top;">comment</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">domain</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">expires</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">httponly</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">max-age</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">path</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">secure</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">version</td><td style="vertical-align:top;">:</td><td><div></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">env</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">HTTP_ACCEPT</td><td style="vertical-align:top;">:</td><td><div>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_ACCEPT_ENCODING</td><td style="vertical-align:top;">:</td><td><div>gzip, deflate</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_ACCEPT_LANGUAGE</td><td style="vertical-align:top;">:</td><td><div>en-us</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_CONNECTION</td><td style="vertical-align:top;">:</td><td><div>keep-alive</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_COOKIE</td><td style="vertical-align:top;">:</td><td><div>session_id_admin=127.0.0.1-2a34b6e8-7adc-42f3-a1be-7dc754917077; session_id_fbmayor=127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_DNT</td><td style="vertical-align:top;">:</td><td><div>1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_HOST</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1:8088</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">HTTP_USER_AGENT</td><td style="vertical-align:top;">:</td><td><div>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/537.75.14</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">PATH_INFO</td><td style="vertical-align:top;">:</td><td><div>/fbmayor/graphAPI/collect_posts</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">QUERY_STRING</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">REMOTE_ADDR</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">REMOTE_PORT</td><td style="vertical-align:top;">:</td><td><div>56037</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">REQUEST_METHOD</td><td style="vertical-align:top;">:</td><td><div>GET</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SCRIPT_NAME</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SERVER_NAME</td><td style="vertical-align:top;">:</td><td><div>maclogair.local</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SERVER_PORT</td><td style="vertical-align:top;">:</td><td><div>8088</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SERVER_PROTOCOL</td><td style="vertical-align:top;">:</td><td><div>HTTP/1.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">SERVER_SOFTWARE</td><td style="vertical-align:top;">:</td><td><div>Rocket 1.2.6</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">app_folders</td><td style="vertical-align:top;">:</td><td><div>set([&#x27;/Applications/web2py.app/Contents/Resources/applications/fbmayor/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/fb_event/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/admin/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/welcome/&#x27;])</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">applications_parent</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cmd_args</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cmd_options</td><td style="vertical-align:top;">:</td><td><div>&lt;Values at 0x104201d40: {&#x27;verbose&#x27;: False, &#x27;ip&#x27;: &#x27;127.0.0.1&#x27;, &#x27;debuglevel&#x27;: 30, &#x27;with_scheduler&#x27;: False, &#x27;ips&#x27;: [&#x27;fe80::60c:ceff:fee3:df4a%en0&#x27;, &#x27;192.168.100.4&#x27;], &#x27;shutdown_timeout&#x27;: 5, &#x27;taskbar&#x27;: False, &#x27;with_coverage&#x27;: False, &#x27;port&#x27;: 8000, &#x27;maxthreads&#x27;: None, &#x27;softcron&#x27;: False, &#x27;server_name&#x27;: &#x27;maclogair.local&#x27;, &#x27;bpython&#x27;: False, &#x27;nogui&#x27;: False, &#x27;pid_filename&#x27;: &#x27;httpserver.pid&#x27;, &#x27;extcron&#x27;: False, &#x27;runcron&#x27;: False, &#x27;run_system_tests&#x27;: False, &#x27;test&#x27;: None, &#x27;folder&#x27;: &#x27;/Applications/web2py.app/Contents/Resources&#x27;, &#x27;config&#x27;: &#x27;&#x27;, &#x27;minthreads&#x27;: None, &#x27;shell&#x27;: None, &#x27;run&#x27;: &#x27;&#x27;, &#x27;log_filename&#x27;: &#x27;httpserver.log&#x27;, &#x27;profiler_dir&#x27;: None, &#x27;args&#x27;: [&#x27;&#x27;], &#x27;socket_timeout&#x27;: 5, &#x27;ssl_ca_certificate&#x27;: None, &#x27;scheduler&#x27;: None, &#x27;interfaces&#x27;: None, &#x27;ssl_private_key&#x27;: &#x27;&#x27;, &#x27;scheduler_groups&#x27;: None, &#x27;password&#x27;: &#x27;&lt;ask&gt;&#x27;, &#x27;request_queue_size&#x27;: 5, &#x27;ssl_certificate&#x27;: &#x27;&#x27;, &#x27;cronjob&#x27;: False, &#x27;numthreads&#x27;: None, &#x27;quiet&#x27;: False, &#x27;import_models&#x27;: False, &#x27;timeout&#x27;: 10, &#x27;plain&#x27;: False, &#x27;nobanner&#x27;: False}&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">db_sessions</td><td style="vertical-align:top;">:</td><td><div>set([])</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">debugging</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">gluon_parent</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_accept</td><td style="vertical-align:top;">:</td><td><div>text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_accept_encoding</td><td style="vertical-align:top;">:</td><td><div>gzip, deflate</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_accept_language</td><td style="vertical-align:top;">:</td><td><div>en-us</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_connection</td><td style="vertical-align:top;">:</td><td><div>keep-alive</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_cookie</td><td style="vertical-align:top;">:</td><td><div>session_id_admin=127.0.0.1-2a34b6e8-7adc-42f3-a1be-7dc754917077; session_id_fbmayor=127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_dnt</td><td style="vertical-align:top;">:</td><td><div>1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_host</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1:8088</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">http_user_agent</td><td style="vertical-align:top;">:</td><td><div>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/537.75.14</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_jython</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_pypy</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_source</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">local_hosts</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>192.168.100.4</div></td></tr><tr><td><div>::ffff:127.0.0.1</div></td></tr><tr><td><div>::1</div></td></tr><tr><td><div>fe80::60c:ceff:fee3:df4a%en0</div></td></tr><tr><td><div>maclogair.local</div></td></tr><tr><td><div>127.0.0.1</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">path_info</td><td style="vertical-align:top;">:</td><td><div>/fbmayor/graphAPI/collect_posts</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">query_string</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">remote_addr</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">remote_port</td><td style="vertical-align:top;">:</td><td><div>56037</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">request_method</td><td style="vertical-align:top;">:</td><td><div>GET</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">request_uri</td><td style="vertical-align:top;">:</td><td><div>/fbmayor/graphAPI/collect_posts</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">script_name</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">server_name</td><td style="vertical-align:top;">:</td><td><div>maclogair.local</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">server_port</td><td style="vertical-align:top;">:</td><td><div>8088</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">server_protocol</td><td style="vertical-align:top;">:</td><td><div>HTTP/1.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">server_software</td><td style="vertical-align:top;">:</td><td><div>Rocket 1.2.6</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">web2py_path</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">web2py_version</td><td style="vertical-align:top;">:</td><td><div>2.8.2-stable+timestamp.2013.11.28.13.54.07</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.errors</td><td style="vertical-align:top;">:</td><td><div>&lt;open file &#x27;&lt;stderr&gt;&#x27;, mode &#x27;w&#x27; at 0x10028b1e0&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.file_wrapper</td><td style="vertical-align:top;">:</td><td><div>&lt;class wsgiref.util.FileWrapper at 0x1041be328&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.input</td><td style="vertical-align:top;">:</td><td><div>&lt;socket._fileobject object at 0x1126e0650&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.multiprocess</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.multithread</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.run_once</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.url_scheme</td><td style="vertical-align:top;">:</td><td><div>http</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi.version</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>1</div></td></tr><tr><td><div>0</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_errors</td><td style="vertical-align:top;">:</td><td><div>&lt;open file &#x27;&lt;stderr&gt;&#x27;, mode &#x27;w&#x27; at 0x10028b1e0&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_file_wrapper</td><td style="vertical-align:top;">:</td><td><div>&lt;class wsgiref.util.FileWrapper at 0x1041be328&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_input</td><td style="vertical-align:top;">:</td><td><div>&lt;socket._fileobject object at 0x1126e0650&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_multiprocess</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_multithread</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_run_once</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_url_scheme</td><td style="vertical-align:top;">:</td><td><div>http</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi_version</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>1</div></td></tr><tr><td><div>0</div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">extension</td><td style="vertical-align:top;">:</td><td><div>html</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">folder</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources/applications/fbmayor/</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">function</td><td style="vertical-align:top;">:</td><td><div>collect_posts</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">global_settings</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">app_folders</td><td style="vertical-align:top;">:</td><td><div>set([&#x27;/Applications/web2py.app/Contents/Resources/applications/fbmayor/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/fb_event/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/admin/&#x27;, &#x27;/Applications/web2py.app/Contents/Resources/applications/welcome/&#x27;])</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">applications_parent</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cmd_args</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cmd_options</td><td style="vertical-align:top;">:</td><td><div>&lt;Values at 0x104201d40: {&#x27;verbose&#x27;: False, &#x27;ip&#x27;: &#x27;127.0.0.1&#x27;, &#x27;debuglevel&#x27;: 30, &#x27;with_scheduler&#x27;: False, &#x27;ips&#x27;: [&#x27;fe80::60c:ceff:fee3:df4a%en0&#x27;, &#x27;192.168.100.4&#x27;], &#x27;shutdown_timeout&#x27;: 5, &#x27;taskbar&#x27;: False, &#x27;with_coverage&#x27;: False, &#x27;port&#x27;: 8000, &#x27;maxthreads&#x27;: None, &#x27;softcron&#x27;: False, &#x27;server_name&#x27;: &#x27;maclogair.local&#x27;, &#x27;bpython&#x27;: False, &#x27;nogui&#x27;: False, &#x27;pid_filename&#x27;: &#x27;httpserver.pid&#x27;, &#x27;extcron&#x27;: False, &#x27;runcron&#x27;: False, &#x27;run_system_tests&#x27;: False, &#x27;test&#x27;: None, &#x27;folder&#x27;: &#x27;/Applications/web2py.app/Contents/Resources&#x27;, &#x27;config&#x27;: &#x27;&#x27;, &#x27;minthreads&#x27;: None, &#x27;shell&#x27;: None, &#x27;run&#x27;: &#x27;&#x27;, &#x27;log_filename&#x27;: &#x27;httpserver.log&#x27;, &#x27;profiler_dir&#x27;: None, &#x27;args&#x27;: [&#x27;&#x27;], &#x27;socket_timeout&#x27;: 5, &#x27;ssl_ca_certificate&#x27;: None, &#x27;scheduler&#x27;: None, &#x27;interfaces&#x27;: None, &#x27;ssl_private_key&#x27;: &#x27;&#x27;, &#x27;scheduler_groups&#x27;: None, &#x27;password&#x27;: &#x27;&lt;ask&gt;&#x27;, &#x27;request_queue_size&#x27;: 5, &#x27;ssl_certificate&#x27;: &#x27;&#x27;, &#x27;cronjob&#x27;: False, &#x27;numthreads&#x27;: None, &#x27;quiet&#x27;: False, &#x27;import_models&#x27;: False, &#x27;timeout&#x27;: 10, &#x27;plain&#x27;: False, &#x27;nobanner&#x27;: False}&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">db_sessions</td><td style="vertical-align:top;">:</td><td><div>set([])</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">debugging</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">gluon_parent</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_jython</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_pypy</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_source</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">local_hosts</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>192.168.100.4</div></td></tr><tr><td><div>::ffff:127.0.0.1</div></td></tr><tr><td><div>::1</div></td></tr><tr><td><div>fe80::60c:ceff:fee3:df4a%en0</div></td></tr><tr><td><div>maclogair.local</div></td></tr><tr><td><div>127.0.0.1</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">web2py_version</td><td style="vertical-align:top;">:</td><td><div>2.8.2-stable+timestamp.2013.11.28.13.54.07</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_https</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_local</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">is_restful</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">now</td><td style="vertical-align:top;">:</td><td><div>datetime.datetime(2014, 5, 6, 21, 15, 46, 112176)</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">raw_args</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">raw_extension</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">url</td><td style="vertical-align:top;">:</td><td><div>/fbmayor/graphAPI/collect_posts</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">utcnow</td><td style="vertical-align:top;">:</td><td><div>datetime.datetime(2014, 5, 6, 13, 15, 46, 112188)</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">uuid</td><td style="vertical-align:top;">:</td><td><div>fbmayor/127.0.0.1.2014-05-06.21-15-46.0b82f782-bf58-48a8-8839-017b0c801e0e</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">wsgi</td><td style="vertical-align:top;">:</td><td><div>&lt;gluon.main.LazyWSGI object at 0x10e0d5950&gt;</div></td></tr></table></div>'
tRp70
sS'frames'
p71
(lp72
(dp73
S'file'
p74
S'/Applications/web2py.app/Contents/Resources/gluon/restricted.py'
p75
sS'dump'
p76
(dp77
S'environment'
p78
S"{'A': <class 'gluon.html.A'>, 'ANY_OF': <class 'gluon.validators.ANY_OF'>, 'Auth': <class 'gluon.tools.Auth'>, 'B': <class 'gluon.html.B'>, 'BEAUTIFY': <class 'gluon.html.BEAUTIFY'>, 'BODY': <class 'gluon.html.BODY'>, 'BR': <class 'gluon.html.BR'>, 'BUTTON': <class 'gluon.html.BUTTON'>, 'CAT': <class 'gluon.html.CAT'>, 'CENTER': <class 'gluon.html.CENTER'>, ...}"
p79
sS'ccode'
p80
S'<code object <module> at 0x10e0e1cb0, file "/App...cations/fbmayor/controllers/graphAPI.py", line 2>'
p81
ssS'lnum'
p82
I217
sS'lines'
p83
(dp84
I212
S'    try:'
p85
sI213
S'        if isinstance(code, types.CodeType):'
p86
sI214
S'            ccode = code'
p87
sI215
S'        else:'
p88
sI216
S'            ccode = compile2(code, layer)'
p89
sI217
S'        exec ccode in environment'
p90
sI218
S'    except HTTP:'
p91
sI219
S'        raise'
p92
sI220
S'    except RestrictedError:'
p93
sI221
S'        # do not encapsulate (obfuscate) the original RestrictedError'
p94
ssS'call'
p95
S"(code='# -*- coding: utf-8 -*-\\nimport ExtendedOpenGraph...\\n\\nresponse._vars=response._caller(collect_posts)\\n', environment={'A': <class 'gluon.html.A'>, 'ANY_OF': <class 'gluon.validators.ANY_OF'>, 'Auth': <class 'gluon.tools.Auth'>, 'B': <class 'gluon.html.B'>, 'BEAUTIFY': <class 'gluon.html.BEAUTIFY'>, 'BODY': <class 'gluon.html.BODY'>, 'BR': <class 'gluon.html.BR'>, 'BUTTON': <class 'gluon.html.BUTTON'>, 'CAT': <class 'gluon.html.CAT'>, 'CENTER': <class 'gluon.html.CENTER'>, ...}, layer='/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py')"
p96
sS'func'
p97
S'restricted'
p98
sa(dp99
g74
S'/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py'
p100
sg76
(dp101
sg82
I1277
sg83
(dp102
I1266
S"            total_post_likes = rows.last()['likes_count'] - rows.first()['likes_count']"
p103
sI1267
S"            total_post_comments = rows.last()['comment_count'] - rows.first()['comment_count']"
p104
sI1268
S"            total_post_shares = rows.last()['shares_count'] - rows.first()['shares_count']"
p105
sI1269
S'    else:'
p106
sI1270
S'        total_post_likes = 0'
p107
sI1271
S'        total_post_comments = 0'
p108
sI1272
S'        total_post_shares = 0'
p109
sI1273
S''
sI1274
S'    result = [total_post_likes,total_post_comments,total_post_shares]'
p110
sI1275
S'    return result'
p111
ssg95
S'()'
p112
sg97
S'<module>'
p113
sa(dp114
g74
S'/Applications/web2py.app/Contents/Resources/gluon/globals.py'
p115
sg76
(dp116
S'self'
p117
S'undefined'
p118
sS'f'
S'<function collect_posts>'
p119
ssg82
I372
sg83
(dp120
I367
S'        self.menu = []             # used by the default view layout'
p121
sI368
S'        self.files = []            # used by web2py_ajax.html'
p122
sI369
S'        self.generic_patterns = []  # patterns to allow generic views'
p123
sI370
S"        self.delimiters = ('{{', '}}')"
p124
sI371
S'        self._vars = None'
p125
sI372
S'        self._caller = lambda f: f()'
p126
sI373
S'        self._view_environment = None'
p127
sI374
S'        self._custom_commit = None'
p128
sI375
S'        self._custom_rollback = None'
p129
sI376
S''
ssg95
S'(f=<function collect_posts>)'
p130
sg97
S'<lambda>'
p131
sa(dp132
g74
S'/Applications/web2py.app/Contents/Resources/gluon/tools.py'
p133
sg76
(dp134
S'action'
p135
S'<function collect_posts>'
p136
sS'a'
S'()'
p137
sS'b'
S'{}'
p138
ssg82
I3239
sg83
(dp139
I3234
S'                    flag = condition'
p140
sI3235
S'                if not flag:'
p141
sI3236
S'                    current.session.flash = self.messages.access_denied'
p142
sI3237
S'                    return call_or_redirect('
p143
sI3238
S'                        self.settings.on_failed_authorization)'
p144
sI3239
S'                return action(*a, **b)'
p145
sI3240
S'            f.__doc__ = action.__doc__'
p146
sI3241
S'            f.__name__ = action.__name__'
p147
sI3242
S'            f.__dict__.update(action.__dict__)'
p148
sI3243
S'            return f'
p149
ssg95
S'(*a=(), **b={})'
p150
sg97
S'f'
sa(dp151
g74
S'/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py'
p152
sg76
(dp153
S'row.pageid'
p154
S"'237834243051486'"
p155
sS'global getPagePosts'
p156
S'<function getPagePosts>'
p157
sS'row'
p158
S"<Row {'pageid': '237834243051486'}>"
p159
ssg82
I181
sg83
(dp160
I176
S'@auth.requires_login()'
p161
sI177
S'def collect_posts():'
p162
sI178
S'    import time'
p163
sI179
S'    rows = fbpl().select(fbpl.page.pageid)'
p164
sI180
S'    for row in rows:'
p165
sI181
S'        getPagePosts(row.pageid)'
p166
sI182
S'        time.sleep(1)'
p167
sI183
S'    return "All page posts Finished"'
p168
sI184
S''
sI185
S'#4.'
p169
ssg95
S'()'
p170
sg97
S'collect_posts'
p171
sa(dp172
g74
S'/Applications/web2py.app/Contents/Resources/gluon/tools.py'
p173
sg76
(dp174
S'action'
p175
S'<function getPagePosts>'
p176
sS'a'
S"('237834243051486',)"
p177
sS'b'
g138
ssg82
I3239
sg83
(dp178
I3234
S'                    flag = condition'
p179
sI3235
S'                if not flag:'
p180
sI3236
S'                    current.session.flash = self.messages.access_denied'
p181
sI3237
S'                    return call_or_redirect('
p182
sI3238
S'                        self.settings.on_failed_authorization)'
p183
sI3239
S'                return action(*a, **b)'
p184
sI3240
S'            f.__doc__ = action.__doc__'
p185
sI3241
S'            f.__name__ = action.__name__'
p186
sI3242
S'            f.__dict__.update(action.__dict__)'
p187
sI3243
S'            return f'
p188
ssg95
S"(*a=('237834243051486',), **b={})"
p189
sg97
S'f'
sa(dp190
g74
S'/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py'
p191
sg76
(dp192
S'graph'
p193
S'<facebook.GraphAPI object>'
p194
sS'args'
p195
g118
sS'pageid'
p196
S"'237834243051486'"
p197
sS'graph.request'
p198
S'<bound method GraphAPI.request of <facebook.GraphAPI object>>'
p199
sS'posts_data'
p200
g118
ssg82
I191
sg83
(dp201
I192
S'        data = []'
p202
sI193
S'        data = posts_data["data"]'
p203
sI194
S'    except GraphAPIError, e:'
p204
sI195
S'        message=e.result'
p205
sI186
S'@auth.requires_login()'
p206
sI187
S'def getPagePosts(pageid):'
p207
sI188
S'    import time'
p208
sI189
S'    try:'
p209
sI190
S'        graph = getGraph()'
p210
sI191
S"        posts_data=graph.request(pageid + '/posts', args={'fields':'id, place, message, updated_time, from, created_time, status_type, type, link, picture, likes.limit(1).summary(true), shares, comments.limit(1).summary(true), object_id'})"
p211
ssg95
S"(pageid='237834243051486')"
p212
sg97
S'getPagePosts'
p213
sa(dp214
g74
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/facebook.py'
p215
sg76
(dp216
S'self.timeout'
p217
S'None'
p218
sS'self'
p219
S'<facebook.GraphAPI object>'
p220
sS'post_data'
p221
S'None'
p222
sS'timeout'
p223
g118
ssg82
I295
sg83
(dp224
I290
S'                args["access_token"] = self.access_token'
p225
sI291
S'        post_data = None if post_args is None else urllib.urlencode(post_args)'
p226
sI292
S'        try:'
p227
sI293
S'            file = urllib2.urlopen("https://graph.facebook.com/" + path + "?" +'
p228
sI294
S'                                   urllib.urlencode(args),'
p229
sI295
S'                                   post_data, timeout=self.timeout)'
p230
sI296
S'        except urllib2.HTTPError, e:'
p231
sI297
S'            response = _parse_json(e.read())'
p232
sI298
S'            raise GraphAPIError(response)'
p233
sI299
S'        except TypeError:'
p234
ssg95
S"(self=<facebook.GraphAPI object>, path='237834243051486/posts', args={'access_token': 'CAADSl0gHeTUBAEuFvC6ZAGOZBoIoO0LuJ2UflY5I73R4Eza...9HbiCu9w1PZBgfptmLj9rpOOe2CFBUd9HmvSezf4rpsi3U3YI', 'fields': 'id, place, message, updated_time, from, created_...hares, comments.limit(1).summary(true), object_id'}, post_args=None)"
p235
sg97
g68
sa(dp236
g74
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py'
p237
sg76
(dp238
S'_opener.open'
p239
S'<bound method OpenerDirector.open of <urllib2.OpenerDirector instance>>'
p240
sS'url'
p241
S"'https://graph.facebook.com/237834243051486/posts...ments.limit%281%29.summary%28true%29%2C+object_id'"
p242
sS'data'
p243
S'None'
p244
sS'global _opener'
p245
S'<urllib2.OpenerDirector instance>'
p246
sS'timeout'
p247
S'None'
p248
ssg82
I127
sg83
(dp249
I128
S''
sI129
S'def install_opener(opener):'
p250
sI130
S'    global _opener'
p251
sI131
S'    _opener = opener'
p252
sI122
S'_opener = None'
p253
sI123
S'def urlopen(url, data=None, timeout=socket._GLOBAL_DEFAULT_TIMEOUT):'
p254
sI124
S'    global _opener'
p255
sI125
S'    if _opener is None:'
p256
sI126
S'        _opener = build_opener()'
p257
sI127
S'    return _opener.open(url, data, timeout)'
p258
ssg95
S"(url='https://graph.facebook.com/237834243051486/posts...ments.limit%281%29.summary%28true%29%2C+object_id', data=None, timeout=None)"
p259
sg97
S'urlopen'
p260
sa(dp261
g74
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py'
p262
sg76
(dp263
S'self'
p264
S'<urllib2.OpenerDirector instance>'
p265
sS'req'
p266
S'<urllib2.Request instance>'
p267
sS'data'
p268
S'None'
p269
sS'response'
p270
g118
sS'self._open'
p271
S'<bound method OpenerDirector._open of <urllib2.OpenerDirector instance>>'
p272
ssg82
I404
sg83
(dp273
I399
S'        meth_name = protocol+"_request"'
p274
sI400
S'        for processor in self.process_request.get(protocol, []):'
p275
sI401
S'            meth = getattr(processor, meth_name)'
p276
sI402
S'            req = meth(req)'
p277
sI403
S''
sI404
S'        response = self._open(req, data)'
p278
sI405
S''
sI406
S'        # post-process response'
p279
sI407
S'        meth_name = protocol+"_response"'
p280
sI408
S'        for processor in self.process_response.get(protocol, []):'
p281
ssg95
S"(self=<urllib2.OpenerDirector instance>, fullurl='https://graph.facebook.com/237834243051486/posts...ments.limit%281%29.summary%28true%29%2C+object_id', data=None, timeout=None)"
p282
sg97
S'open'
p283
sa(dp284
g74
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py'
p285
sg76
(dp286
S'req'
p287
S'<urllib2.Request instance>'
p288
ssg82
I422
sg83
(dp289
I417
S'        if result:'
p290
sI418
S'            return result'
p291
sI419
S''
sI420
S'        protocol = req.get_type()'
p292
sI421
S'        result = self._call_chain(self.handle_open, protocol, protocol +'
p293
sI422
S"                                  '_open', req)"
p294
sI423
S'        if result:'
p295
sI424
S'            return result'
p296
sI425
S''
sI426
S"        return self._call_chain(self.handle_open, 'unknown',"
p297
ssg95
S'(self=<urllib2.OpenerDirector instance>, req=<urllib2.Request instance>, data=None)'
p298
sg97
S'_open'
p299
sa(dp300
g74
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py'
p301
sg76
(dp302
S'args'
p303
S'(<urllib2.Request instance>,)'
p304
sS'result'
p305
g118
sS'func'
p306
S'<bound method HTTPSHandler.https_open of <urllib2.HTTPSHandler instance>>'
p307
ssg82
I382
sg83
(dp308
I384
S'                return result'
p309
sI385
S''
sI386
S'    def open(self, fullurl, data=None, timeout=socket._GLOBAL_DEFAULT_TIMEOUT):'
p310
sI377
S'        # could.  Otherwise, they return the response.'
p311
sI378
S'        handlers = chain.get(kind, ())'
p312
sI379
S'        for handler in handlers:'
p313
sI380
S'            func = getattr(handler, meth_name)'
p314
sI381
S''
sI382
S'            result = func(*args)'
p315
sI383
S'            if result is not None:'
p316
ssg95
S"(self=<urllib2.OpenerDirector instance>, chain={'file': [<urllib2.FileHandler instance>], 'ftp': [<urllib2.FTPHandler instance>], 'http': [<urllib2.HTTPHandler instance>], 'https': [<urllib2.HTTPSHandler instance>], 'unknown': [<urllib2.UnknownHandler instance>]}, kind='https', meth_name='https_open', *args=(<urllib2.Request instance>,))"
p317
sg97
S'_call_chain'
p318
sa(dp319
g74
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py'
p320
sg76
(dp321
S'self'
p322
S'<urllib2.HTTPSHandler instance>'
p323
sS'req'
p324
S'<urllib2.Request instance>'
p325
sS'global httplib'
p326
S"<module 'httplib' from '/Library/Frameworks/Pyth...ramework/Versions/2.7/lib/python2.7/httplib.pyc'>"
p327
sS'self.do_open'
p328
S'<bound method HTTPSHandler.do_open of <urllib2.HTTPSHandler instance>>'
p329
sS'httplib.HTTPSConnection'
p330
S'<class httplib.HTTPSConnection>'
p331
ssg82
I1222
sg83
(dp332
I1217
S''
sI1218
S"if hasattr(httplib, 'HTTPS'):"
p333
sI1219
S'    class HTTPSHandler(AbstractHTTPHandler):'
p334
sI1220
S''
sI1221
S'        def https_open(self, req):'
p335
sI1222
S'            return self.do_open(httplib.HTTPSConnection, req)'
p336
sI1223
S''
sI1224
S'        https_request = AbstractHTTPHandler.do_request_'
p337
sI1225
S''
sI1226
S'class HTTPCookieProcessor(BaseHandler):'
p338
ssg95
S'(self=<urllib2.HTTPSHandler instance>, req=<urllib2.Request instance>)'
p339
sg97
S'https_open'
p340
sa(dp341
g74
S'/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py'
p342
sg76
(dp343
S'err'
p344
S"error(65, 'No route to host')"
p345
sS'global URLError'
p346
S"<class 'urllib2.URLError'>"
p347
ssg82
I1184
sg83
(dp348
I1184
S'            raise URLError(err)'
p349
sI1185
S'        else:'
p350
sI1186
S'            try:'
p351
sI1187
S'                r = h.getresponse(buffering=True)'
p352
sI1188
S'            except TypeError: # buffering kw not supported'
p353
sI1179
S''
sI1180
S'        try:'
p354
sI1181
S'            h.request(req.get_method(), req.get_selector(), req.data, headers)'
p355
sI1182
S'        except socket.error, err: # XXX what error?'
p356
sI1183
S'            h.close()'
p357
ssg95
S'(self=<urllib2.HTTPSHandler instance>, http_class=<class httplib.HTTPSConnection>, req=<urllib2.Request instance>)'
p358
sg97
S'do_open'
p359
sasS'pyver'
p360
S'Python 2.7.5: /Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python (prefix: /Library/Frameworks/Python.framework/Versions/2.7)'
p361
sS'session'
p362
g69
(S's\x97\x0c\x00\x00<div><table><tr><td style="font-weight:bold;vertical-align:top;">auth</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">expiration</td><td style="vertical-align:top;">:</td><td><div>3600</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">hmac_key</td><td style="vertical-align:top;">:</td><td><div>af6e21b3-8f56-4a0f-8e40-9f0e85f0004e</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">last_visit</td><td style="vertical-align:top;">:</td><td><div>datetime.datetime(2014, 5, 6, 21, 15, 41, 101028)</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">remember</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">user</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">first_name</td><td style="vertical-align:top;">:</td><td><div>Chih-Yuan</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">id</td><td style="vertical-align:top;">:</td><td><div>1L</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">last_name</td><td style="vertical-align:top;">:</td><td><div>Chen</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">registration_id</td><td style="vertical-align:top;">:</td><td><div>614901526</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">registration_key</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">username</td><td style="vertical-align:top;">:</td><td><div>614901526</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">user_groups</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">1</td><td style="vertical-align:top;">:</td><td><div>user_1</div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">flash</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">last_orderby</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">last_query</td><td style="vertical-align:top;">:</td><td><div>fbpl.team_counts.id&gt;0</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">redirect_uri</td><td style="vertical-align:top;">:</td><td><div>http://127.0.0.1:8088/fbmayor/default/user/login</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">token</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">access_token</td><td style="vertical-align:top;">:</td><td><div>CAADSl0gHeTUBAEuFvC6ZAGOZBoIoO0LuJ2UflY5I73R4EzaZAaZAoPFZBqZB2WAdEe2YzfJn2VRWogX3Eq3OXh5RLvbcDZAnC3HFkxlE0c7DFBOULWcAYSSdY09jXZCl7GZAfSYF89HbiCu9w1PZBgfptmLj9rpOOe2CFBUd9HmvSezf4rpsi3U3YI</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">expires</td><td style="vertical-align:top;">:</td><td><div>1404544508.806448</div></td></tr></table></div></td></tr></table></div>'
tRp363
sS'etype'
p364
S"<class 'urllib2.URLError'>"
p365
sS'date'
p366
S'Tue May  6 21:16:16 2014'
p367
sS'response'
p368
g69
(S's3&\x00\x00<div><table><tr><td style="font-weight:bold;vertical-align:top;">body</td><td style="vertical-align:top;">:</td><td><div>&lt;cStringIO.StringO object at 0x112112c38&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">cookies</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">session_id_fbmayor</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93<table><tr><td style="font-weight:bold;vertical-align:top;">comment</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">domain</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">expires</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">httponly</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">max-age</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">path</td><td style="vertical-align:top;">:</td><td><div>/</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">secure</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">version</td><td style="vertical-align:top;">:</td><td><div></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">delimiters</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>{{</div></td></tr><tr><td><div>}}</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">files</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">flash</td><td style="vertical-align:top;">:</td><td><div></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">generic_patterns</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">google_analytics_id</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">headers</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">X-Powered-By</td><td style="vertical-align:top;">:</td><td><div>web2py</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">logo</td><td style="vertical-align:top;">:</td><td><div><a class="brand" data-w2p_disable_with="default" href="http://www.web2py.com/"><b>web<span>2</span>py</b>&trade;&nbsp;</a></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">menu</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div><table><tr><td><div>POI</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_form</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Add POI</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addplace</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>People</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_people</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Add People</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addpeople</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Page</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_page</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Page Count</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/index</div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Add Page</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addpage</div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Update Pages</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/graphAPI/countAllPageSocialCount</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Post</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_post</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Add Post</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addpost</div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Get Post</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/graphAPI/collect_posts</div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Update Posts</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/graphAPI/countAllPostSocialCount</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td><div><table><tr><td><div>Event</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/display_event</div></td></tr><tr><td><div><table><tr><td><div><table><tr><td><div>Add Event</div></td></tr><tr><td><div>False</div></td></tr><tr><td><div>/fbmayor/default/addevent</div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">meta</td><td style="vertical-align:top;">:</td><td><div><table><tr><td style="font-weight:bold;vertical-align:top;">author</td><td style="vertical-align:top;">:</td><td><div>Your Name &lt;you@example.com&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">description</td><td style="vertical-align:top;">:</td><td><div>a cool new app</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">generator</td><td style="vertical-align:top;">:</td><td><div>Web2py Web Framework</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">keywords</td><td style="vertical-align:top;">:</td><td><div>web2py, python, framework</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">models_to_run</td><td style="vertical-align:top;">:</td><td><div><table><tr><td><div>^\\w+\\.py$</div></td></tr><tr><td><div>^graphAPI/\\w+\\.py$</div></td></tr><tr><td><div>^graphAPI/collect_posts/\\w+\\.py$</div></td></tr></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">postprocessing</td><td style="vertical-align:top;">:</td><td><div><table></table></div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_client</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_cookie_compression_level</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_cookie_expires</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_cookie_key</td><td style="vertical-align:top;">:</td><td><div>None</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_data_name</td><td style="vertical-align:top;">:</td><td><div>session_data_fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_file</td><td style="vertical-align:top;">:</td><td><div>&lt;open file &#x27;/Applications/web2py.app/Contents/Resources/applications/fbmayor/sessions/127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93&#x27;, mode &#x27;rb+&#x27; at 0x10a1c3780&gt;</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_filename</td><td style="vertical-align:top;">:</td><td><div>/Applications/web2py.app/Contents/Resources/applications/fbmayor/sessions/127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_hash</td><td style="vertical-align:top;">:</td><td><div>d14f9d5c49e19db667ae8905e934ac16</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_id</td><td style="vertical-align:top;">:</td><td><div>127.0.0.1-ee990b7b-c322-479c-bb24-a3e23d089c93</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_id_name</td><td style="vertical-align:top;">:</td><td><div>session_id_fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_locked</td><td style="vertical-align:top;">:</td><td><div>True</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_masterapp</td><td style="vertical-align:top;">:</td><td><div>fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_new</td><td style="vertical-align:top;">:</td><td><div>False</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">session_storage_type</td><td style="vertical-align:top;">:</td><td><div>file</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">status</td><td style="vertical-align:top;">:</td><td><div>200</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">subtitle</td><td style="vertical-align:top;">:</td><td><div>customize me!</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">title</td><td style="vertical-align:top;">:</td><td><div>Fbmayor</div></td></tr><tr><td style="font-weight:bold;vertical-align:top;">view</td><td style="vertical-align:top;">:</td><td><div>graphAPI/collect_posts.html</div></td></tr></table></div>'
tRp369
sS'locals'
p370
(dp371
S'err'
p372
S"error(65, 'No route to host')"
p373
sS'h'
S'<httplib.HTTPSConnection instance>'
p374
sS'self'
p375
S'<urllib2.HTTPSHandler instance>'
p376
sS'req'
p377
S'<urllib2.Request instance>'
p378
sS'headers'
p379
S"{'Connection': 'close', 'Host': 'graph.facebook.com', 'User-Agent': 'Python-urllib/2.7'}"
p380
sS'host'
p381
S"'graph.facebook.com'"
p382
sS'http_class'
p383
S'<class httplib.HTTPSConnection>'
p384
sssS'traceback'
p385
S'Traceback (most recent call last):\n  File "/Applications/web2py.app/Contents/Resources/gluon/restricted.py", line 217, in restricted\n    exec ccode in environment\n  File "/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py", line 1277, in <module>\n  File "/Applications/web2py.app/Contents/Resources/gluon/globals.py", line 372, in <lambda>\n    self._caller = lambda f: f()\n  File "/Applications/web2py.app/Contents/Resources/gluon/tools.py", line 3239, in f\n    return action(*a, **b)\n  File "/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py", line 181, in collect_posts\n    getPagePosts(row.pageid)\n  File "/Applications/web2py.app/Contents/Resources/gluon/tools.py", line 3239, in f\n    return action(*a, **b)\n  File "/Applications/web2py.app/Contents/Resources/applications/fbmayor/controllers/graphAPI.py", line 191, in getPagePosts\n    posts_data=graph.request(pageid + \'/posts\', args={\'fields\':\'id, place, message, updated_time, from, created_time, status_type, type, link, picture, likes.limit(1).summary(true), shares, comments.limit(1).summary(true), object_id\'})\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/facebook.py", line 295, in request\n    post_data, timeout=self.timeout)\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py", line 127, in urlopen\n    return _opener.open(url, data, timeout)\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py", line 404, in open\n    response = self._open(req, data)\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py", line 422, in _open\n    \'_open\', req)\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py", line 382, in _call_chain\n    result = func(*args)\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py", line 1222, in https_open\n    return self.do_open(httplib.HTTPSConnection, req)\n  File "/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py", line 1184, in do_open\n    raise URLError(err)\nURLError: <urlopen error [Errno 65] No route to host>\n'
p386
s.